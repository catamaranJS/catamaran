"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),CES=require("CES"),BABYLON=require("../lib/babylon"),utils=require("../utils/utils"),defaults=utils.defaultArgs();defaults._name="camera";var c_cameravr=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?defaults:arguments[0];_classCallCheck(this,t),this.modal=document.createElement("div"),this.modal.classList.add("a-orientation-modal"),this.modal.style.display="none",document.body.appendChild(this.modal),this.canvasList=null,this.name=e._name,this.obj,this.objVR=null,this.scene=e._scene,this.canvas=e._canvas,this.oneAxis=!1,this.mode="normal",this.hud=null,this.glitchEnabled=!1;var i=document.querySelectorAll("canvas");this.canvasList=Array.from(i),90===Math.abs(window.orientation)?(this.toggleCanvas("block"),initVR()):(this.toggleCanvas(),this.modal.style.display="block"),this.setListners(),this.options={name:this.name,init:this.constructor,obj:this.obj,objVR:this.objVR},CES.Component.extend(this.options)}return _createClass(t,[{key:"initVR",value:function(){this.obj=new BABYLON.VirtualJoysticksCamera("VJCamera",_opts._position,this.scene),this.obj.attachControl(this.canvas,!1);try{CATAMARAN.isMobile(),this.inertiaSpeed="Android"==CATAMARAN._mobileOS?.6:.7,this.rotationSpeed="Android"==CATAMARAN._mobileOS?4:2,this.obj._rightjoystick.reverseUpDown=!0,this.obj._rightjoystick._rotateOnAxisRelativeToMesh=!0,this.obj.inertia=this.inertiaSpeed,this.obj._rightjoystick._inverseRotationSpeed=this.rotationSpeed,this.obj._rightjoystick._rotationSpeed=this.rotationSpeed,this.oneAxis&&(this.obj._rightjoystick._axisTargetedByUpAndDown=1,this.obj._rightjoystick._axisTargetedByLeftAndRight=1,this.obj._leftjoystick._axisTargetedByUpAndDown=0,this.obj._leftjoystick._axisTargetedByLeftAndRight=0),this.objVR=new BABYLON.VRDeviceOrientationFreeCamera("VRCamera",BABYLON.Vector3.Zero(),this.scene,0),this.objVR.checkCollisions=!1,this.objVR.applyGravity=!1,this.objVR.attachControl(this.canvas,!0),this.objVR.position=this.obj.position;var t=document.querySelectorAll("canvas");this.canvasList=Array.from(t),this.setCanvasTouch()}catch(e){console.log(e),console.log("requires -> https://code.jquery.com/pep/0.4.1/pep.js")}this.scene.activeCamera=this.obj,this.pickResult=null,CATAMARAN.debug&&this.debug()}},{key:"debug",value:function(){window.objVR=this.objVR,window.obj=this.obj}},{key:"toggle",value:function(){"normal"==this.mode?(this.mode="vr",null!=this.scene&&(null!=this.hud?(this.scene.activeCameras[0]=this.objVR,this.glitchEnabled):(console.log(this.objVR),console.log(this.scene),this.scene.activeCamera=this.objVR))):(this.mode="normal",null!=this.scene&&(null!=this.hud?this.scene.activeCameras[0]=this.obj:this.scene.activeCamera=this.obj))}},{key:"readDeviceOrientation",value:function(){90===Math.abs(window.orientation)?(null==this.objVR&&(this.toggleCanvas("block"),this.initVR()),this.landscapeMode=!0,this.modal.style.display="none"):(this.toggleCanvas(),this.modal.style.display="block",this.landscapeMode=!1)}},{key:"toggleCanvas",value:function(){for(var t=arguments.length<=0||void 0===arguments[0]?"none":arguments[0],e=0;e<this.canvasList.length;e++)this.canvasList[e].style.display=t;document.querySelector(".vr-button").style.display=t}},{key:"rayPick",value:function(){this.pickResult=this.scene.pick(this.scene.pointerX,this.scene.pointerY)}},{key:"setCanvasTouch",value:function(){for(var t=0;t<this.canvasList.length;t++)this.canvasList[t].setAttribute("touch-action","none"),this.canvasList[t].style.width="",this.canvasList[t].style.height=""}},{key:"setListners",value:function(){this.setCanvasTouch(),document.querySelector(".vr-button").addEventListener("click",this.toggle.bind(this)),window.addEventListener("click",this.rayPick.bind(this)),window.addEventListener("orientationchange",this.readDeviceOrientation.bind(this),!1)}}]),t}();module.exports=c_cameravr;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvYmFieWxvbmNlcy9jb21wb25lbnRzL2NfY2FtZXJhdnIuanMiXSwibmFtZXMiOlsiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJDRVMiLCJyZXF1aXJlIiwiQkFCWUxPTiIsInV0aWxzIiwiZGVmYXVsdHMiLCJkZWZhdWx0QXJncyIsIl9uYW1lIiwiY19jYW1lcmF2ciIsIl9vcHRzIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwidGhpcyIsIm1vZGFsIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwic3R5bGUiLCJkaXNwbGF5IiwiYm9keSIsImFwcGVuZENoaWxkIiwiY2FudmFzTGlzdCIsIm5hbWUiLCJvYmoiLCJvYmpWUiIsInNjZW5lIiwiX3NjZW5lIiwiY2FudmFzIiwiX2NhbnZhcyIsIm9uZUF4aXMiLCJtb2RlIiwiaHVkIiwiZ2xpdGNoRW5hYmxlZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJBcnJheSIsImZyb20iLCJNYXRoIiwiYWJzIiwid2luZG93Iiwib3JpZW50YXRpb24iLCJ0b2dnbGVDYW52YXMiLCJpbml0VlIiLCJzZXRMaXN0bmVycyIsIm9wdGlvbnMiLCJpbml0IiwiY29uc3RydWN0b3IiLCJDb21wb25lbnQiLCJleHRlbmQiLCJ2YWx1ZSIsIlZpcnR1YWxKb3lzdGlja3NDYW1lcmEiLCJfcG9zaXRpb24iLCJhdHRhY2hDb250cm9sIiwiQ0FUQU1BUkFOIiwiaXNNb2JpbGUiLCJpbmVydGlhU3BlZWQiLCJfbW9iaWxlT1MiLCJyb3RhdGlvblNwZWVkIiwiX3JpZ2h0am95c3RpY2siLCJyZXZlcnNlVXBEb3duIiwiX3JvdGF0ZU9uQXhpc1JlbGF0aXZlVG9NZXNoIiwiaW5lcnRpYSIsIl9pbnZlcnNlUm90YXRpb25TcGVlZCIsIl9yb3RhdGlvblNwZWVkIiwiX2F4aXNUYXJnZXRlZEJ5VXBBbmREb3duIiwiX2F4aXNUYXJnZXRlZEJ5TGVmdEFuZFJpZ2h0IiwiX2xlZnRqb3lzdGljayIsIlZSRGV2aWNlT3JpZW50YXRpb25GcmVlQ2FtZXJhIiwiVmVjdG9yMyIsIlplcm8iLCJjaGVja0NvbGxpc2lvbnMiLCJhcHBseUdyYXZpdHkiLCJwb3NpdGlvbiIsInNldENhbnZhc1RvdWNoIiwiZSIsImNvbnNvbGUiLCJsb2ciLCJhY3RpdmVDYW1lcmEiLCJwaWNrUmVzdWx0IiwiZGVidWciLCJhY3RpdmVDYW1lcmFzIiwibGFuZHNjYXBlTW9kZSIsIl9tb2RlIiwicXVlcnlTZWxlY3RvciIsInBpY2siLCJwb2ludGVyWCIsInBvaW50ZXJZIiwic2V0QXR0cmlidXRlIiwid2lkdGgiLCJoZWlnaHQiLCJhZGRFdmVudExpc3RlbmVyIiwidG9nZ2xlIiwiYmluZCIsInJheVBpY2siLCJyZWFkRGV2aWNlT3JpZW50YXRpb24iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQUZoSCxHQUFJQyxjQUFlLFdBQWUsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQVMsSUFBSyxHQUFJQyxHQUFJLEVBQUdBLEVBQUlELEVBQU1FLE9BQVFELElBQUssQ0FBRSxHQUFJRSxHQUFhSCxFQUFNQyxFQUFJRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQU9ELEVBQVdFLGNBQWUsRUFBVSxTQUFXRixLQUFZQSxFQUFXRyxVQUFXLEdBQU1DLE9BQU9DLGVBQWVULEVBQVFJLEVBQVdNLElBQUtOLElBQWlCLE1B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QU1BLFVBQUEsR0FDbEJyQixFQUFFLEVBQUdBLEVBQUl1QixLQUFLVSxXQUFXaEMsT0FBUUQsSUFDeEN1QixLQUFLVSxXQUFXakMsR0FBRzZCLE1BQU1DLFFBQVUrRCxDQUVwQ3BFLFVBQVNxRSxjQUFjLGNBQWNqRSxNQUFNQyxRQUFVK0QsS0FrQmxEckYsSUFBSyxVQUNMb0QsTUFoQkcsV0FDTnJDLEtBQUtrRSxXQUFhbEUsS0FBS2MsTUFBTTBELEtBQUt4RSxLQUFLYyxNQUFNMkQsU0FBVXpFLEtBQUtjLE1BQU00RCxhQW9CL0R6RixJQUFLLGlCQUNMb0QsTUFqQlUsV0FDYixJQUFJLEdBQUk1RCxHQUFFLEVBQUdBLEVBQUl1QixLQUFLVSxXQUFXaEMsT0FBUUQsSUFDeEN1QixLQUFLVSxXQUFXakMsR0FBR2tHLGFBQWEsZUFBZ0IsUUFDaEQzRSxLQUFLVSxXQUFXakMsR0FBRzZCLE1BQU1zRSxNQUFRLEdBQ2pDNUUsS0FBS1UsV0FBV2pDLEdBQUc2QixNQUFNdUUsT0FBUyxNQXFCaEM1RixJQUFLLGNBQ0xvRCxNQWxCTyxXQUNWckMsS0FBSzZELGlCQUNMM0QsU0FBU3FFLGNBQWMsY0FBY08saUJBQWlCLFFBQVM5RSxLQUFLK0UsT0FBT0MsS0FBS2hGLE9BQ2hGMkIsT0FBT21ELGlCQUFpQixRQUFTOUUsS0FBS2lGLFFBQVFELEtBQUtoRixPQUNuRDJCLE9BQU9tRCxpQkFBaUIsb0JBQXFCOUUsS0FBS2tGLHNCQUFzQkYsS0FBS2hGLE9BQU8sT0FwSm5GSixJQXlKTnVGLFFBQU9DLFFBQVV4RiIsImZpbGUiOiJjb3JlL2JhYnlsb25jZXMvY29tcG9uZW50cy9jX2NhbWVyYXZyLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIENFUyA9IHJlcXVpcmUoJ0NFUycpO1xudmFyIEJBQllMT04gPSByZXF1aXJlKCcuLi9saWIvYmFieWxvbicpO1xudmFyIHV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMnKTtcblxudmFyIGRlZmF1bHRzID0gdXRpbHMuZGVmYXVsdEFyZ3MoKTtcbmRlZmF1bHRzLl9uYW1lID0gJ2NhbWVyYSc7XG5cblxuY2xhc3MgY19jYW1lcmF2ciB7XG5cdGNvbnN0cnVjdG9yKF9vcHRzID0gZGVmYXVsdHMpe1xuXHRcdHRoaXMubW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHR0aGlzLm1vZGFsLmNsYXNzTGlzdC5hZGQoJ2Etb3JpZW50YXRpb24tbW9kYWwnKTtcblx0XHR0aGlzLm1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm1vZGFsKTtcblx0XHR0aGlzLmNhbnZhc0xpc3QgPSBudWxsO1xuXHRcdHRoaXMubmFtZSA9IF9vcHRzLl9uYW1lO1xuXHRcdHRoaXMub2JqO1xuXHRcdHRoaXMub2JqVlIgPSBudWxsO1xuXHRcdHRoaXMuc2NlbmUgPSAgX29wdHMuX3NjZW5lO1xuXHRcdHRoaXMuY2FudmFzID0gX29wdHMuX2NhbnZhcztcblx0XHR0aGlzLm9uZUF4aXMgPSBmYWxzZTtcblx0XHR0aGlzLm1vZGUgPSAnbm9ybWFsJztcblx0XHR0aGlzLmh1ZCAgPSBudWxsO1xuXHRcdHRoaXMuZ2xpdGNoRW5hYmxlZCA9IGZhbHNlO1xuICAgXHRcdHZhciBjYW52YXNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnY2FudmFzJyk7XG4gICAgXHR0aGlzLmNhbnZhc0xpc3QgPSBBcnJheS5mcm9tKGNhbnZhc0xpc3QpO1xuICAgIFx0aWYoTWF0aC5hYnMod2luZG93Lm9yaWVudGF0aW9uKSA9PT0gOTApe1xuXHRcdFx0dGhpcy50b2dnbGVDYW52YXMoJ2Jsb2NrJyk7XG5cdFx0XHRpbml0VlIoKTtcblx0XHR9ZWxzZXtcblx0XHRcdHRoaXMudG9nZ2xlQ2FudmFzKCk7XG5cdFx0XHR0aGlzLm1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuXHRcdH1cblx0XHR0aGlzLnNldExpc3RuZXJzKCk7XG5cdFx0dGhpcy5vcHRpb25zID0ge1xuXHRcdFx0bmFtZTp0aGlzLm5hbWUsXG5cdFx0XHRpbml0OiB0aGlzLmNvbnN0cnVjdG9yLFxuXHRcdFx0b2JqOnRoaXMub2JqLFxuXHRcdFx0b2JqVlI6dGhpcy5vYmpWUlxuXHRcdH1cblxuXHRcdENFUy5Db21wb25lbnQuZXh0ZW5kKHRoaXMub3B0aW9ucyk7XG5cdH1cblxuXHRpbml0VlIoKXtcblx0XHR0aGlzLm9iaiA9IG5ldyBCQUJZTE9OLlZpcnR1YWxKb3lzdGlja3NDYW1lcmEoXCJWSkNhbWVyYVwiLCBfb3B0cy5fcG9zaXRpb24sIHRoaXMuc2NlbmUpO1xuICAgICAgICB0aGlzLm9iai5hdHRhY2hDb250cm9sKHRoaXMuY2FudmFzLCBmYWxzZSk7XG4gICAgICAgIHRyeXtcbiAgICAgICAgQ0FUQU1BUkFOLmlzTW9iaWxlKCk7XG4gICAgICAgIHRoaXMuaW5lcnRpYVNwZWVkICA9IENBVEFNQVJBTi5fbW9iaWxlT1MgPT0gJ0FuZHJvaWQnID8gMC42IDogMC43O1xuICAgICAgICB0aGlzLnJvdGF0aW9uU3BlZWQgID0gQ0FUQU1BUkFOLl9tb2JpbGVPUyA9PSAnQW5kcm9pZCc/IDQgOiAyO1xuICAgICAgICB0aGlzLm9iai5fcmlnaHRqb3lzdGljay5yZXZlcnNlVXBEb3duID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vYmouX3JpZ2h0am95c3RpY2suX3JvdGF0ZU9uQXhpc1JlbGF0aXZlVG9NZXNoID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vYmouaW5lcnRpYSA9IHRoaXMuaW5lcnRpYVNwZWVkO1xuICAgICAgICB0aGlzLm9iai5fcmlnaHRqb3lzdGljay5faW52ZXJzZVJvdGF0aW9uU3BlZWQgPSB0aGlzLnJvdGF0aW9uU3BlZWQ7XG4gICAgICAgIHRoaXMub2JqLl9yaWdodGpveXN0aWNrLl9yb3RhdGlvblNwZWVkID0gdGhpcy5yb3RhdGlvblNwZWVkO1xuICAgICAgICBpZih0aGlzLm9uZUF4aXMpe1xuICAgICAgICBcdHRoaXMub2JqLl9yaWdodGpveXN0aWNrLl9heGlzVGFyZ2V0ZWRCeVVwQW5kRG93biA9IDE7XG4gICAgICAgIFx0dGhpcy5vYmouX3JpZ2h0am95c3RpY2suX2F4aXNUYXJnZXRlZEJ5TGVmdEFuZFJpZ2h0ID0gMTtcbiAgICAgICAgXHR0aGlzLm9iai5fbGVmdGpveXN0aWNrLl9heGlzVGFyZ2V0ZWRCeVVwQW5kRG93biA9IDA7XG4gICAgICAgIFx0dGhpcy5vYmouX2xlZnRqb3lzdGljay5fYXhpc1RhcmdldGVkQnlMZWZ0QW5kUmlnaHQgPSAwO1xuICAgICAgICB9XG5cdFx0dGhpcy5vYmpWUiAgPSBuZXcgQkFCWUxPTi5WUkRldmljZU9yaWVudGF0aW9uRnJlZUNhbWVyYShcIlZSQ2FtZXJhXCIsICBCQUJZTE9OLlZlY3RvcjMuWmVybygpLCB0aGlzLnNjZW5lLCAwKTtcblx0XHQvL3RoaXMub2JqVlIgID0gbmV3IEJBQllMT04uV2ViVlJGcmVlQ2FtZXJhKFwiVlJDYW1lcmFcIiwgIEJBQllMT04uVmVjdG9yMy5aZXJvKCksIHRoaXMuc2NlbmUsIDEpO1xuXHRcdHRoaXMub2JqVlIuY2hlY2tDb2xsaXNpb25zID0gZmFsc2U7XG4gICAgICAgIHRoaXMub2JqVlIuYXBwbHlHcmF2aXR5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMub2JqVlIuYXR0YWNoQ29udHJvbCh0aGlzLmNhbnZhcyAsIHRydWUpO1xuICAgICAgICB0aGlzLm9ialZSLnBvc2l0aW9uID0gdGhpcy5vYmoucG9zaXRpb247XG4gICAgICAgIHZhciBjYW52YXNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnY2FudmFzJyk7XG4gICAgXHR0aGlzLmNhbnZhc0xpc3QgPSBBcnJheS5mcm9tKGNhbnZhc0xpc3QpO1xuICAgIFx0dGhpcy5zZXRDYW52YXNUb3VjaCgpO1xuICAgIFx0IH1jYXRjaChlKXtcbiAgICAgICAgXHRjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgXHRjb25zb2xlLmxvZygncmVxdWlyZXMgLT4gaHR0cHM6Ly9jb2RlLmpxdWVyeS5jb20vcGVwLzAuNC4xL3BlcC5qcycpO1xuICAgICAgICB9XG5cdFx0dGhpcy5zY2VuZS5hY3RpdmVDYW1lcmEgPSB0aGlzLm9iajtcblx0XHR0aGlzLnBpY2tSZXN1bHQgPSBudWxsO1xuICAgICAgICBpZihDQVRBTUFSQU4uZGVidWcpe1xuICAgICAgICBcdHRoaXMuZGVidWcoKTtcbiAgICAgICAgfVxuXHR9XG5cblx0ZGVidWcoKXtcblx0XHR3aW5kb3cub2JqVlIgPSB0aGlzLm9ialZSO1xuICAgICAgICB3aW5kb3cub2JqID0gdGhpcy5vYmo7XG5cdH1cblxuXHR0b2dnbGUoKSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT0gJ25vcm1hbCcpIHtcbiAgICAgICAgICAgIHRoaXMubW9kZSA9ICd2cic7XG4gICAgICAgICAgICBpZiAodGhpcy5zY2VuZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5odWQgIT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hY3RpdmVDYW1lcmFzWzBdID0gdGhpcy5vYmpWUjtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5nbGl0Y2hFbmFibGVkKXtcbiAgICAgICAgICAgICAgICAgICAgXHQvL2Z4XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgXHRjb25zb2xlLmxvZyh0aGlzLm9ialZSKTtcbiAgICAgICAgICAgICAgICBcdC8vdGhpcy5vYmpWUi5hdHRhY2hDb250cm9sKHRoaXMuY2FudmFzICwgdHJ1ZSk7XG4gICAgICAgICAgICAgXHRcdGNvbnNvbGUubG9nKHRoaXMuc2NlbmUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLmFjdGl2ZUNhbWVyYSA9IHRoaXMub2JqVlI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tb2RlID0gJ25vcm1hbCc7XG4gICAgICAgICAgICBpZiAodGhpcy5zY2VuZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5odWQgIT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hY3RpdmVDYW1lcmFzWzBdID0gdGhpcy5vYmo7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuYWN0aXZlQ2FtZXJhID0gdGhpcy5vYmo7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVhZERldmljZU9yaWVudGF0aW9uKCkge1xuICAgICAgaWYgKE1hdGguYWJzKHdpbmRvdy5vcmllbnRhdGlvbikgPT09IDkwKSB7XG4gICAgICBcdGlmKHRoaXMub2JqVlIgPT0gbnVsbCl7XG4gICAgICBcdFx0dGhpcy50b2dnbGVDYW52YXMoJ2Jsb2NrJyk7XG4gICAgICBcdFx0dGhpcy5pbml0VlIoKTtcbiAgICAgIFx0fVxuICAgICAgICB0aGlzLmxhbmRzY2FwZU1vZGUgPSB0cnVlO1xuICAgICAgICB0aGlzLm1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgXHR0aGlzLnRvZ2dsZUNhbnZhcygpO1xuICAgICAgXHR0aGlzLm1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgXHR0aGlzLmxhbmRzY2FwZU1vZGUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIFxuICAgIH1cblxuICAgIHRvZ2dsZUNhbnZhcyhfbW9kZSA9ICdub25lJyl7XG4gICAgXHRmb3IobGV0IGk9MDsgaSA8IHRoaXMuY2FudmFzTGlzdC5sZW5ndGg7IGkrKyl7XG4gICAgXHRcdHRoaXMuY2FudmFzTGlzdFtpXS5zdHlsZS5kaXNwbGF5ID0gX21vZGU7XG4gICAgXHR9XG4gICAgXHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudnItYnV0dG9uJykuc3R5bGUuZGlzcGxheSA9IF9tb2RlO1xuICAgIH1cblxuICAgIHJheVBpY2soKXtcbiAgICBcdHRoaXMucGlja1Jlc3VsdCA9IHRoaXMuc2NlbmUucGljayh0aGlzLnNjZW5lLnBvaW50ZXJYLCB0aGlzLnNjZW5lLnBvaW50ZXJZKTtcbiAgXHQgXHQvL2NvbnNvbGUubG9nKHRoaXMucGlja1Jlc3VsdCk7XG4gICAgfVxuXG4gICAgc2V0Q2FudmFzVG91Y2goKXtcbiAgICBcdGZvcihsZXQgaT0wOyBpIDwgdGhpcy5jYW52YXNMaXN0Lmxlbmd0aDsgaSsrKXtcbiAgICBcdFx0dGhpcy5jYW52YXNMaXN0W2ldLnNldEF0dHJpYnV0ZShcInRvdWNoLWFjdGlvblwiLCAnbm9uZScpO1xuICAgIFx0XHR0aGlzLmNhbnZhc0xpc3RbaV0uc3R5bGUud2lkdGggPSAnJztcbiAgICBcdFx0dGhpcy5jYW52YXNMaXN0W2ldLnN0eWxlLmhlaWdodCA9ICcnO1xuICAgIFx0fVxuICAgIH1cblxuICAgIHNldExpc3RuZXJzKCl7XG4gICAgXHR0aGlzLnNldENhbnZhc1RvdWNoKCk7XG4gICAgXHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudnItYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnRvZ2dsZS5iaW5kKHRoaXMpKTtcbiAgICBcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMucmF5UGljay5iaW5kKHRoaXMpKTtcbiAgICBcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMucmVhZERldmljZU9yaWVudGF0aW9uLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB9XG4gICAgXG5cbn1cbm1vZHVsZS5leHBvcnRzID0gY19jYW1lcmF2cjsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=