"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),_entities=require("./entities"),entities=_interopRequireWildcard(_entities),_systems=require("./systems"),systems=_interopRequireWildcard(_systems),_xhrRequest=require("../xhr/Request"),CES=require("ces"),utils=require("./utils/utils"),BABYLON=require("./lib/babylon"),lsd=function(){function lsd(){var e=arguments.length<=0||void 0===arguments[0]?document.body:arguments[0];_classCallCheck(this,lsd),this._defaults=utils.defaultArgs(),this._defaultsScene_two=utils.defaultArgs(),this._defaultsScene_two._appendEL=this._defaults._appendEL=e,this._data=null,this._currentScene,this._e_scene=new entities.e_scene(this._defaults),this._e_scene_two=new entities.e_scene(this._defaultsScene_two),this._e_cameravr=null,this._scenes=[],this._activeScene=0,this.camera=null,this.world=new CES.World,this.world.addEntity(this._e_scene.entity),this.world.addEntity(this._e_scene_two.entity),this.canvas,this._assets=[],Promise.all([document.querySelector("canvas")]).then(this.init.apply(this))}return _createClass(lsd,[{key:"init",value:function(){this.canvas=document.querySelector("canvas"),this.defaults=new _xhrRequest.Request("/assets/scene/scene.json",this.dataLoaded.bind(this))}},{key:"dataLoaded",value:function(){this._data=this.defaults.data,this.canvas.addEventListener("canvas_init",function(e){this.jsonAssets=this._data.assets,this._currentScene=this._defaults._scene=this._e_scene.scene.scene,this._scenes.push(this._currentScene),this._currentAltScene=this._e_scene_two.scene.scene,this._scenes.push(this._currentAltScene),utils.assetsLoad.apply(this)}.bind(this),!1)}},{key:"initListners",value:function(){window.addEventListener("resize",function(){this.canvas.heigth=window.innerHeight,this.canvas.width=window.innerWidth,this._currentScene.getEngine().resize()}.bind(this))}},{key:"loopJsonArr",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"entities":arguments[1];switch(t){case"entities":for(var s=0;s<this._data.entities.length;s++)e(s);break;case"systems":for(var s=0;s<this._data.systems.length;s++)e(s);break;default:for(var s=0;s<this._data.entities.length;s++)e(s)}}},{key:"setDefaultsAndMaterials",value:function setDefaultsAndMaterials(i){this._data.entities[i].defaults._scene=this._currentScene,this._data.entities[i].defaults._canvas=this.canvas;try{this._data.entities[i].defaults=utils.merge_objects(eval("entities."+this._data.entities[i].defaults.e_type+".defaults()"),this._data.entities[i].defaults)}catch(e){console.log(e+" - error loading entity no defaults set")}}},{key:"setVectorsAndOtherDefaults",value:function setVectorsAndOtherDefaults(i){void 0!=typeof this._data.entities[i].defaults._material&&(this._data.entities[i].defaults._material=utils.getMaterials(this._data.materials,this._data.entities[i].defaults._material)),void 0!=typeof this._data.entities[i].defaults._position&&(this._data.entities[i].defaults._position=utils.getVector(this._data.entities[i].defaults._position)),void 0!=typeof this._data.entities[i].defaults._rotation&&(this._data.entities[i].defaults._rotation=utils.getVector(this._data.entities[i].defaults._rotation,"rotation"));try{var ent=eval("new entities."+this._data.entities[i].defaults.e_type+"(this._data.entities[i].defaults)");this.world.addEntity(ent.entity)}catch(e){console.log(e+" - error loading entity")}}},{key:"setSystems",value:function setSystems(i){try{this._data.systems[i].defaults._canvas=this.canvas,this._data.systems[i].defaults._scene=this._currentScene,this.world.addSystem(eval("new systems."+this._data.systems[i].defaults.s_type+"(this._data.systems[i].defaults)"))}catch(e){console.log(e+" - error loading system")}}},{key:"assetLoadingFinished",value:function(){this.loopJsonArr(this.setDefaultsAndMaterials.bind(this)),this.loopJsonArr(this.setVectorsAndOtherDefaults.bind(this)),this.loopJsonArr(this.setSystems.bind(this),"systems"),this.initSceneAnimation(),this.initListners()}},{key:"swapScene",value:function(){var e=this._scenes[this._activeScene].activeCameras,t=this._scenes[this._activeScene];this._activeScene=0==this._activeScene?1:0,this._scenes[this._activeScene].activeCameras=e,this._scenes[this._activeScene].lights=t.lights;for(var s=0;s<this._scenes[this._activeScene].activeCameras.length;s++)this._scenes[this._activeScene].activeCameras[s]._scene=this._scenes[this._activeScene]}},{key:"sceneDemo",value:function(){var e=BABYLON.Mesh.CreateSphere("sphereTest",16,2,this._scenes[this._activeScene]);e.position.y=1,e.layerMask=268435455}},{key:"initSceneAnimation",value:function(){this.tick=.01,window.scene=this._scenes[this._activeScene],this.world._currentScene=this._currentScene,this.world._multiuserInit=!0,this._defaults._scene.collisionsEnabled=!0;for(var e=0;e<this._defaults._scene.cameras.length;e++)this._defaults._scene.cameras[e].checkCollisions=!0;this._scenes[0].renderLoop=function(){this._currentScene.activeCamera&&this.world._multiuserInit&&this._currentScene.render()}.bind(this),this._scenes[1].renderLoop=function(){this._currentAltScene.render()}.bind(this),this._scenes[this._activeScene].getEngine().runRenderLoop(function(){this.tick+=.01,window.tick=this.tick,this.world.update(this.tick),this._scenes[this._activeScene].renderLoop()}.bind(this))}},{key:"initSound",value:function(){console.log(window._sharedData),null!=window._sharedData.Sound&&(this._BabylonSound=new BABYLON.Sound(window._sharedData.Sound.sID,window._sharedData.trackURL))}}]),lsd}();module.exports=lsd;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvbHNkL2luZGV4LmpzIl0sIm5hbWVzIjpbIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwib2JqIiwiX19lc01vZHVsZSIsIm5ld09iaiIsImtleSIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImRlZmluZVByb3BlcnR5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwiX2VudGl0aWVzIiwicmVxdWlyZSIsImVudGl0aWVzIiwiX3N5c3RlbXMiLCJzeXN0ZW1zIiwiX3hoclJlcXVlc3QiLCJDRVMiLCJ1dGlscyIsIkJBQllMT04iLCJsc2QiLCJfYXBwZW5kRWwiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJkb2N1bWVudCIsImJvZHkiLCJ0aGlzIiwiX2RlZmF1bHRzIiwiZGVmYXVsdEFyZ3MiLCJfZGVmYXVsdHNTY2VuZV90d28iLCJfYXBwZW5kRUwiLCJfZGF0YSIsIl9jdXJyZW50U2NlbmUiLCJfZV9zY2VuZSIsImVfc2NlbmUiLCJfZV9zY2VuZV90d28iLCJfZV9jYW1lcmF2ciIsIl9zY2VuZXMiLCJfYWN0aXZlU2NlbmUiLCJjYW1lcmEiLCJ3b3JsZCIsIldvcmxkIiwiYWRkRW50aXR5IiwiZW50aXR5IiwiY2FudmFzIiwiX2Fzc2V0cyIsIlByb21pc2UiLCJhbGwiLCJxdWVyeVNlbGVjdG9yIiwidGhlbiIsImluaXQiLCJhcHBseSIsInZhbHVlIiwiZGVmYXVsdHMiLCJSZXF1ZXN0IiwiZGF0YUxvYWRlZCIsImJpbmQiLCJkYXRhIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJqc29uQXNzZXRzIiwiYXNzZXRzIiwiX3NjZW5lIiwic2NlbmUiLCJwdXNoIiwiX2N1cnJlbnRBbHRTY2VuZSIsImFzc2V0c0xvYWQiLCJ3aW5kb3ciLCJoZWlndGgiLCJpbm5lckhlaWdodCIsIndpZHRoIiwiaW5uZXJXaWR0aCIsImdldEVuZ2luZSIsInJlc2l6ZSIsIl9mdW5jdGlvbkNhbGwiLCJfdHlwZSIsInNldERlZmF1bHRzQW5kTWF0ZXJpYWxzIiwiX2NhbnZhcyIsIm1lcmdlX29iamVjdHMiLCJldmFsIiwiZV90eXBlIiwiY29uc29sZSIsImxvZyIsInNldFZlY3RvcnNBbmRPdGhlckRlZmF1bHRzIiwiX21hdGVyaWFsIiwiZ2V0TWF0ZXJpYWxzIiwibWF0ZXJpYWxzIiwiX3Bvc2l0aW9uIiwiZ2V0VmVjdG9yIiwiX3JvdGF0aW9uIiwiZW50Iiwic2V0U3lzdGVtcyIsImFkZFN5c3RlbSIsInNfdHlwZSIsImxvb3BKc29uQXJyIiwiaW5pdFNjZW5lQW5pbWF0aW9uIiwiaW5pdExpc3RuZXJzIiwiY2FtU3dhcCIsImFjdGl2ZUNhbWVyYXMiLCJwcmV2U2NlbmUiLCJsaWdodHMiLCJzcGhlcmUiLCJNZXNoIiwiQ3JlYXRlU3BoZXJlIiwicG9zaXRpb24iLCJ5IiwibGF5ZXJNYXNrIiwidGljayIsIl9tdWx0aXVzZXJJbml0IiwiY29sbGlzaW9uc0VuYWJsZWQiLCJjYW1lcmFzIiwiY2hlY2tDb2xsaXNpb25zIiwicmVuZGVyTG9vcCIsImFjdGl2ZUNhbWVyYSIsInJlbmRlciIsInJ1blJlbmRlckxvb3AiLCJ1cGRhdGUiLCJfc2hhcmVkRGF0YSIsIlNvdW5kIiwiX0JhYnlsb25Tb3VuZCIsInNJRCIsInRyYWNrVVJMIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFJQSxTQUFTQSx5QkFBd0JDLEdBQU8sR0FBSUEsR0FBT0EsRUFBSUMsV0FBYyxNQUFPRCxFQUFjLElBQUlFLEtBQWEsSUFBVyxNQUFQRixFQUFlLElBQUssR0FBSUcsS0FBT0gsR0FBV0ksT0FBT0MsVUFBVUMsZUFBZUMs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LENBRXpEckYsTUFBS1csUUFBUSxHQUFHMkUsV0FBYSxXQUN4QnRGLEtBQUtNLGNBQWNpRixjQUFnQnZGLEtBQUtjLE1BQU1vRSxnQkFDL0NsRixLQUFLTSxjQUFja0YsVUFFckIxRCxLQUFLOUIsTUFHUEEsS0FBS1csUUFBUSxHQUFHMkUsV0FBYSxXQUN6QnRGLEtBQUt1QyxpQkFBaUJpRCxVQUN4QjFELEtBQUs5QixNQUdSQSxLQUFLVyxRQUFRWCxLQUFLWSxjQUFja0MsWUFBWTJDLGNBQWMsV0FDekR6RixLQUFLaUYsTUFBUSxJQUNieEMsT0FBT3dDLEtBQU9qRixLQUFLaUYsS0FDbkJqRixLQUFLYyxNQUFNNEUsT0FBTzFGLEtBQUtpRixNQUN2QmpGLEtBQUtXLFFBQVFYLEtBQUtZLGNBQWMwRSxjQUMvQnhELEtBQUs5QixVQWtDSnJDLElBQUssWUFDTCtELE1BMUJLLFdBQ1I2QixRQUFRQyxJQUFJZixPQUFPa0QsYUFDWSxNQUE1QmxELE9BQU9rRCxZQUFZQyxRQUNyQjVGLEtBQUs2RixjQUFnQixHQUFJcEcsU0FBUW1HLE1BQU1uRCxPQUFPa0QsWUFBWUMsTUFBTUUsSUFBS3JELE9BQU9rRCxZQUFZSSxlQTlLckZyRyxNQW9MTnNHLFFBQU9DLFFBQVV2RyIsImZpbGUiOiJjb3JlL2xzZC9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBDRVMgPSByZXF1aXJlKCdjZXMnKTtcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMnKTtcbmltcG9ydCAqIGFzIGVudGl0aWVzIGZyb20gJy4vZW50aXRpZXMnO1xuaW1wb3J0ICogYXMgc3lzdGVtcyBmcm9tICcuL3N5c3RlbXMnO1xuaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gJy4uL3hoci9SZXF1ZXN0JztcbnZhciBCQUJZTE9OID0gcmVxdWlyZSgnLi9saWIvYmFieWxvbicpO1xuXG4vKipcbiAqIC4uLlxuICogQGF1dGhvciBCcmVuZG9uIFNtaXRoXG4gKiBodHRwOi8vc2VhY2xvdWQ5Lm9yZ1xuICogTGlnaHRXZWlnaHQgM0QgU3lzdGVtIERlc2lnbiBlbmdpbmVcbiAqL1xuIGNsYXNzIGxzZHtcbiBcdGNvbnN0cnVjdG9yKF9hcHBlbmRFbCA9IGRvY3VtZW50LmJvZHkpe1xuIFx0XHR0aGlzLl9kZWZhdWx0cyA9IHV0aWxzLmRlZmF1bHRBcmdzKCk7XG4gICAgdGhpcy5fZGVmYXVsdHNTY2VuZV90d28gPSB1dGlscy5kZWZhdWx0QXJncygpO1xuIFx0XHR0aGlzLl9kZWZhdWx0c1NjZW5lX3R3by5fYXBwZW5kRUwgPSB0aGlzLl9kZWZhdWx0cy5fYXBwZW5kRUwgPSBfYXBwZW5kRWw7XG4gXHRcdHRoaXMuX2RhdGEgPSBudWxsO1xuIFx0XHR0aGlzLl9jdXJyZW50U2NlbmU7XG4gXHRcdHRoaXMuX2Vfc2NlbmUgPSBuZXcgZW50aXRpZXMuZV9zY2VuZSh0aGlzLl9kZWZhdWx0cyk7XG4gICAgdGhpcy5fZV9zY2VuZV90d28gPSBuZXcgZW50aXRpZXMuZV9zY2VuZSh0aGlzLl9kZWZhdWx0c1NjZW5lX3R3byk7XG4gXHRcdHRoaXMuX2VfY2FtZXJhdnIgPSBudWxsO1xuICAgIHRoaXMuX3NjZW5lcyA9IFtdO1xuICAgIHRoaXMuX2FjdGl2ZVNjZW5lID0gMDtcbiBcdFx0dGhpcy5jYW1lcmEgPSBudWxsO1xuIFx0XHR0aGlzLndvcmxkID0gbmV3IENFUy5Xb3JsZCgpO1xuIFx0XHR0aGlzLndvcmxkLmFkZEVudGl0eSh0aGlzLl9lX3NjZW5lLmVudGl0eSk7XG4gICAgdGhpcy53b3JsZC5hZGRFbnRpdHkodGhpcy5fZV9zY2VuZV90d28uZW50aXR5KTtcbiBcdFx0dGhpcy5jYW52YXM7XG4gXHRcdHRoaXMuX2Fzc2V0cyA9IFtdO1xuIFx0XHRQcm9taXNlLmFsbChbZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY2FudmFzJyldKS50aGVuKHRoaXMuaW5pdC5hcHBseSh0aGlzKSk7XG4gXHR9XG5cbiBcdGluaXQoKXtcbiBcdFx0dGhpcy5jYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKTtcbiBcdFx0dGhpcy5kZWZhdWx0cyA9IG5ldyBSZXF1ZXN0KFwiL2Fzc2V0cy9zY2VuZS9zY2VuZS5qc29uXCIsIHRoaXMuZGF0YUxvYWRlZC5iaW5kKHRoaXMpKTtcbiBcdH1cblxuIFx0ZGF0YUxvYWRlZCgpe1xuIFx0XHR0aGlzLl9kYXRhICA9IHRoaXMuZGVmYXVsdHMuZGF0YTtcbiBcdFx0dGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2FudmFzX2luaXQnLCBmdW5jdGlvbiAoZSkge1xuIFx0XHRcdHRoaXMuanNvbkFzc2V0cyA9IHRoaXMuX2RhdGEuYXNzZXRzO1xuIFx0XHRcdHRoaXMuX2N1cnJlbnRTY2VuZSA9IHRoaXMuX2RlZmF1bHRzLl9zY2VuZSA9IHRoaXMuX2Vfc2NlbmUuc2NlbmUuc2NlbmU7XG4gICAgICB0aGlzLl9zY2VuZXMucHVzaCh0aGlzLl9jdXJyZW50U2NlbmUpO1xuICAgICAgdGhpcy5fY3VycmVudEFsdFNjZW5lICA9IHRoaXMuX2Vfc2NlbmVfdHdvLnNjZW5lLnNjZW5lO1xuICAgICAgdGhpcy5fc2NlbmVzLnB1c2godGhpcy5fY3VycmVudEFsdFNjZW5lKTtcbiBcdFx0XHR1dGlscy5hc3NldHNMb2FkLmFwcGx5KHRoaXMpO1xuIFx0XHR9LmJpbmQodGhpcyksIGZhbHNlKTtcblxuIFx0fVxuXG4gXHRpbml0TGlzdG5lcnMoKXtcbiBcdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgZnVuY3Rpb24gKCkge1xuIFx0XHRcdHRoaXMuY2FudmFzLmhlaWd0aCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiBcdFx0XHR0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1x0XG4gXHRcdFx0dGhpcy5fY3VycmVudFNjZW5lLmdldEVuZ2luZSgpLnJlc2l6ZSgpO1xuIFx0XHR9LmJpbmQodGhpcykpO1xuIFx0fVxuXG4gXHRsb29wSnNvbkFycihfZnVuY3Rpb25DYWxsLCBfdHlwZSA9ICdlbnRpdGllcycpe1xuIFx0XHRzd2l0Y2goX3R5cGUpIHtcblx0XHQgICAgY2FzZSAnZW50aXRpZXMnOlxuXHRcdCAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX2RhdGEuZW50aXRpZXMubGVuZ3RoOyBpKyspe1xuXHRcdCBcdFx0XHRfZnVuY3Rpb25DYWxsKGkpO1xuXHRcdCBcdFx0fVxuXHRcdCAgICAgICAgYnJlYWs7XG5cdFx0ICAgIGNhc2UgJ3N5c3RlbXMnOlxuXHRcdCAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLl9kYXRhLnN5c3RlbXMubGVuZ3RoOyBpKyspe1xuXHRcdCBcdFx0XHRfZnVuY3Rpb25DYWxsKGkpO1xuXHRcdCBcdFx0fVxuXHRcdCAgICAgICAgYnJlYWs7XHQgICAgICAgIFx0XHQgICAgICAgIFxuXHRcdCAgICBkZWZhdWx0OlxuXHRcdCAgICAgXHRmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5fZGF0YS5lbnRpdGllcy5sZW5ndGg7IGkrKyl7XG5cdFx0IFx0XHRcdF9mdW5jdGlvbkNhbGwoaSk7XG5cdFx0IFx0XHR9XG5cdFx0XG5cdFx0fVxuIFx0XHRcbiBcdH1cblxuIFx0c2V0RGVmYXVsdHNBbmRNYXRlcmlhbHMoaSl7XG4gXHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3NjZW5lID0gdGhpcy5fY3VycmVudFNjZW5lO1xuIFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9jYW52YXMgPSB0aGlzLmNhbnZhcztcbiBcdFx0dHJ5e1xuIFx0XHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMgPSB1dGlscy5tZXJnZV9vYmplY3RzKGV2YWwoJ2VudGl0aWVzLicgKyB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLmVfdHlwZStcIi5kZWZhdWx0cygpXCIpLCB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzKTtcbiBcdFx0fWNhdGNoKGUpe1xuIFx0XHRcdGNvbnNvbGUubG9nKGUgKyAnIC0gZXJyb3IgbG9hZGluZyBlbnRpdHkgbm8gZGVmYXVsdHMgc2V0Jyk7XG4gXHRcdH1cbiBcdH1cblxuIFx0c2V0VmVjdG9yc0FuZE90aGVyRGVmYXVsdHMoaSl7XG4gXHRcdGlmKHR5cGVvZiB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9tYXRlcmlhbCAhPSB1bmRlZmluZWQpe1xuIFx0XHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX21hdGVyaWFsID0gdXRpbHMuZ2V0TWF0ZXJpYWxzKHRoaXMuX2RhdGEubWF0ZXJpYWxzLCB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9tYXRlcmlhbCk7XG4gXHRcdH1cbiBcdFx0aWYodHlwZW9mIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3Bvc2l0aW9uICE9IHVuZGVmaW5lZCl7XG4gXHRcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcG9zaXRpb24gPSB1dGlscy5nZXRWZWN0b3IodGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcG9zaXRpb24pO1xuIFx0XHR9XG4gXHRcdGlmKHR5cGVvZiB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9yb3RhdGlvbiAhPSB1bmRlZmluZWQpe1xuIFx0XHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3JvdGF0aW9uID0gdXRpbHMuZ2V0VmVjdG9yKHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3JvdGF0aW9uLCAncm90YXRpb24nKTtcbiBcdFx0fVxuIFx0XHR0cnl7XG4gXHRcdFx0dmFyIGVudCA9IGV2YWwoXCJuZXcgZW50aXRpZXMuXCIgKyB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLmVfdHlwZSArIFwiKHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMpXCIpO1xuIFx0XHRcdHRoaXMud29ybGQuYWRkRW50aXR5KGVudC5lbnRpdHkpO1xuIFx0XHR9Y2F0Y2goZSl7XG4gXHRcdFx0Y29uc29sZS5sb2coZSArICcgLSBlcnJvciBsb2FkaW5nIGVudGl0eScpO1xuIFx0XHR9XG4gXHR9XG5cbiBcdHNldFN5c3RlbXMoaSl7XG4gXHRcdHRyeXtcbiBcdFx0XHR0aGlzLl9kYXRhLnN5c3RlbXNbaV0uZGVmYXVsdHMuX2NhbnZhcyA9IHRoaXMuY2FudmFzO1xuIFx0XHRcdHRoaXMuX2RhdGEuc3lzdGVtc1tpXS5kZWZhdWx0cy5fc2NlbmUgPSB0aGlzLl9jdXJyZW50U2NlbmU7XG4gXHRcdFx0dGhpcy53b3JsZC5hZGRTeXN0ZW0oIGV2YWwoXCJuZXcgc3lzdGVtcy5cIiArIHRoaXMuX2RhdGEuc3lzdGVtc1tpXS5kZWZhdWx0cy5zX3R5cGUgKyBcIih0aGlzLl9kYXRhLnN5c3RlbXNbaV0uZGVmYXVsdHMpXCIpKTtcbiBcdFx0fWNhdGNoKGUpe1xuIFx0XHRcdGNvbnNvbGUubG9nKGUgKyAnIC0gZXJyb3IgbG9hZGluZyBzeXN0ZW0nKTtcbiBcdFx0fVxuIFx0fVxuXG5cbiBcdGFzc2V0TG9hZGluZ0ZpbmlzaGVkKCl7XG4gXHRcdHRoaXMubG9vcEpzb25BcnIodGhpcy5zZXREZWZhdWx0c0FuZE1hdGVyaWFscy5iaW5kKHRoaXMpKTtcbiBcdFx0dGhpcy5sb29wSnNvbkFycih0aGlzLnNldFZlY3RvcnNBbmRPdGhlckRlZmF1bHRzLmJpbmQodGhpcykpO1xuIFx0XHR0aGlzLmxvb3BKc29uQXJyKHRoaXMuc2V0U3lzdGVtcy5iaW5kKHRoaXMpLCAnc3lzdGVtcycpO1xuIFx0XHR0aGlzLmluaXRTY2VuZUFuaW1hdGlvbigpO1xuIFx0XHR0aGlzLmluaXRMaXN0bmVycygpO1xuIFx0fVxuXG4gIHN3YXBTY2VuZSgpe1xuICAgIHZhciBjYW1Td2FwID0gdGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXS5hY3RpdmVDYW1lcmFzO1xuICAgIHZhciBwcmV2U2NlbmUgPSB0aGlzLl9zY2VuZXNbdGhpcy5fYWN0aXZlU2NlbmVdO1xuICAgIHRoaXMuX2FjdGl2ZVNjZW5lICA9IHRoaXMuX2FjdGl2ZVNjZW5lID09IDAgPyAxOjA7XG4gICAgdGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXS5hY3RpdmVDYW1lcmFzID0gY2FtU3dhcDtcbiAgICB0aGlzLl9zY2VuZXNbdGhpcy5fYWN0aXZlU2NlbmVdLmxpZ2h0cyA9IHByZXZTY2VuZS5saWdodHM7XG4gICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX3NjZW5lc1t0aGlzLl9hY3RpdmVTY2VuZV0uYWN0aXZlQ2FtZXJhcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgdGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXS5hY3RpdmVDYW1lcmFzW2ldLl9zY2VuZSA9IHRoaXMuX3NjZW5lc1t0aGlzLl9hY3RpdmVTY2VuZV07XG4gICAgfVxuXG4gIH1cblxuXG4gIHNjZW5lRGVtbygpe1xuICAgIHZhciBzcGhlcmUgPSBCQUJZTE9OLk1lc2guQ3JlYXRlU3BoZXJlKFwic3BoZXJlVGVzdFwiLCAxNiwgMiwgdGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXSk7XG4gICAgc3BoZXJlLnBvc2l0aW9uLnkgPSAxO1xuICAgIHNwaGVyZS5sYXllck1hc2sgPSAweDBGRkZGRkZGO1xuICB9XG5cbiBcdGluaXRTY2VuZUFuaW1hdGlvbigpe1xuIFx0XHR0aGlzLnRpY2sgPSAwLjAxO1xuIFx0XHQvLyB0b2RvIHJlbW92ZSB0aGlzIG9ubHkgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlc1xuIFx0XHR3aW5kb3cuc2NlbmUgPSB0aGlzLl9zY2VuZXNbdGhpcy5fYWN0aXZlU2NlbmVdO1xuIFx0XHR0aGlzLndvcmxkLl9jdXJyZW50U2NlbmUgPSB0aGlzLl9jdXJyZW50U2NlbmU7XG4gICAgLy8gdG9kbyBtZWggZGlzYWJsZSBtdWx0aXVzZXIgXG4gXHRcdHRoaXMud29ybGQuX211bHRpdXNlckluaXQgPSB0cnVlO1xuICAgIHRoaXMuX2RlZmF1bHRzLl9zY2VuZS5jb2xsaXNpb25zRW5hYmxlZCA9IHRydWU7XG4gICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX2RlZmF1bHRzLl9zY2VuZS5jYW1lcmFzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICB0aGlzLl9kZWZhdWx0cy5fc2NlbmUuY2FtZXJhc1tpXS5jaGVja0NvbGxpc2lvbnMgPSB0cnVlO1xuICAgIH1cbiAgICB0aGlzLl9zY2VuZXNbMF0ucmVuZGVyTG9vcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmKHRoaXMuX2N1cnJlbnRTY2VuZS5hY3RpdmVDYW1lcmEgJiYgdGhpcy53b3JsZC5fbXVsdGl1c2VySW5pdCl7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRTY2VuZS5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcyk7XG5cbiAgICBcbiAgICB0aGlzLl9zY2VuZXNbMV0ucmVuZGVyTG9vcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY3VycmVudEFsdFNjZW5lLnJlbmRlcigpO1xuICAgIH0uYmluZCh0aGlzKTtcbiAgICBcblxuIFx0XHR0aGlzLl9zY2VuZXNbdGhpcy5fYWN0aXZlU2NlbmVdLmdldEVuZ2luZSgpLnJ1blJlbmRlckxvb3AoZnVuY3Rpb24gKCkge1xuIFx0XHRcdHRoaXMudGljayArPSAuMDE7XG4gXHRcdFx0d2luZG93LnRpY2sgPSB0aGlzLnRpY2s7XG4gXHRcdFx0dGhpcy53b3JsZC51cGRhdGUodGhpcy50aWNrKTtcbiBcdFx0XHR0aGlzLl9zY2VuZXNbdGhpcy5fYWN0aXZlU2NlbmVdLnJlbmRlckxvb3AoKTtcbiBcdFx0fS5iaW5kKHRoaXMpKTtcblxuXG4gXHR9XG5cblxuXG4gXHQvL2JlbG93IHRoaXMgaXMgY29kZSB0aGF0IHNob3VsZCBldmVudHVhbGx5IGJlIGVsaW1pbmlhdGVkIG9ubHkgZm9yIGhhY2thdGhvbiBwdXJwb3Nlc1xuXG4gXHRpbml0U291bmQoKXtcbiBcdFx0Y29uc29sZS5sb2cod2luZG93Ll9zaGFyZWREYXRhKTtcbiBcdFx0aWYod2luZG93Ll9zaGFyZWREYXRhLlNvdW5kICE9IG51bGwpe1xuIFx0XHRcdHRoaXMuX0JhYnlsb25Tb3VuZCA9IG5ldyBCQUJZTE9OLlNvdW5kKHdpbmRvdy5fc2hhcmVkRGF0YS5Tb3VuZC5zSUQsIHdpbmRvdy5fc2hhcmVkRGF0YS50cmFja1VSTCk7XG4gXHRcdH1cbiBcdH1cblxuXG4gfVxuIG1vZHVsZS5leHBvcnRzID0gbHNkOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==