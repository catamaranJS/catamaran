"use strict";function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i["default"]=t,i}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),_ces=require("ces"),CES=_interopRequireWildcard(_ces),_utilsUtils=require("../utils/utils"),_libBabylon=require("../lib/babylon");Object.defineProperty(exports,"BABYLON",{enumerable:!0,get:function(){return _libBabylon.BABYLON}});var defaults=_utilsUtils.utils.defaultArgs();defaults._name="camera";var c_cameravr=function(){function t(){var i=arguments.length<=0||void 0===arguments[0]?defaults:arguments[0];_classCallCheck(this,t),this.rotationModal=i._hasModal,this.rotationModal&&(this.modal=document.createElement("div"),this.modal.classList.add("a-orientation-modal"),this.modal.style.display="none",document.body.appendChild(this.modal)),this.cursorEnt=null,this.cursor=i._cursor,this.cursorVR1=i._cursorVR1,this.cursorVR2=i._cursorVR2,this.canvasList=null,this.name=i._name,this.opts=i,this.obj,this.objVR=null,this.objOrthoVR=null,this.objOrtho=null,this.scene=i._scene,this.canvas=i._canvas,this.oneAxis=!0,this.mode="normal",this.fpsUIWindow=null,this.fpsUI=i._fpsUI,this.hud=null,this.glitchEnabled=!1;var e=document.querySelectorAll("canvas");this.canvasList=Array.from(e),90!==Math.abs(window.orientation)&&CATAMARAN.isMobile()?(this.toggleCanvas(),this.rotationModal&&(this.modal.style.display="block")):(this.toggleCanvas("block"),this.initVR()),this.setListners(),this.options={name:this.name,init:this.constructor,obj:this.obj,objOrtho:this.objOrtho,objOrthoVR:this.objOrthoVR,objVR:this.objVR},CES.Component.extend(this.options)}return _createClass(t,[{key:"initVR",value:function(){this.objOrtho=new BABYLON.FreeCamera("FreeCamera",BABYLON.Vector3.Zero(),this.opts._scene),this.objOrtho.setTarget(BABYLON.Vector3.Zero()),this.objOrtho.layerMask=this.opts._activeDialogLayer,this.obj=new BABYLON.VirtualJoysticksCamera("VJCamera",this.opts._position,this.scene),this.obj.attachControl(this.canvas,!1);try{CATAMARAN.isMobile(),this.inertiaSpeed="Android"==CATAMARAN._mobileOS?.6:.7,this.rotationSpeed="Android"==CATAMARAN._mobileOS?4:2,this.obj.inputs.attached.virtualJoystick._rightjoystick.reverseUpDown=!0,this.obj.inputs.attached.virtualJoystick._rightjoystick._rotateOnAxisRelativeToMesh=!0,this.obj.inputs.attached.virtualJoystick.camera.inertia=this.inertiaSpeed,this.obj.inputs.attached.virtualJoystick._rightjoystick._inverseRotationSpeed=this.rotationSpeed,this.obj.inputs.attached.virtualJoystick._rightjoystick._rotationSpeed=this.rotationSpeed,this.oneAxis&&(this.obj.inputs.attached.virtualJoystick._rightjoystick._axisTargetedByUpAndDown=3,this.obj.inputs.attached.virtualJoystick._rightjoystick._axisTargetedByLeftAndRight=1,this.obj.inputs.attached.virtualJoystick._leftjoystick._axisTargetedByUpAndDown=2,this.obj.inputs.attached.virtualJoystick._leftjoystick._axisTargetedByLeftAndRight=0),this.objVR=new BABYLON.VRDeviceOrientationFreeCamera("VRCamera",this.opts._position,this.scene,!1),this.objVR.checkCollisions=!1,this.objVR.applyGravity=!1,this.objVR.attachControl(this.canvas,!0),this.objOrthoVR=new BABYLON.WebVRFreeCamera("VRCamera2",new BABYLON.Vector3.Zero,this.scene,!1),this.objOrthoVR.setTarget(BABYLON.Vector3.Zero()),this.objOrthoVR.layerMask=this.opts._activeDialogLayer,this.objOrthoVR._rigCameras[0].layerMask=this.opts._activeDialogLayer,this.objOrthoVR._rigCameras[1].layerMask=this.opts._activeDialogLayer,this.objVR.position=this.obj.position;var t=document.querySelectorAll("canvas");this.canvasList=Array.from(t),this.setCanvasTouch()}catch(i){console.log(i),console.log("requires -> https://code.jquery.com/pep/0.4.1/pep.js")}this.scene.activeCameras.push(this.obj),this.scene.activeCameras.push(this.objOrtho),this.scene.activeCamera=this.obj,this.pickResult=null,this.fpsUI&&(this.bodyEL=new CATAMARAN.core.DOM("body"),this.fpsUIWindow=document.createElement("fpswindow"),this.fpsUIWindow.open=!0,this.fpsUIWindow.classList.add("fpsUIWindow"),this.bodyEL.append(this.fpsUIWindow),this.fpsUIWindow=new CATAMARAN.core.DOM(".fpsUIWindow")),CATAMARAN.debug&&this.debug()}},{key:"debug",value:function(){window.objVR=this.objVR,window.obj=this.obj,window.objOrtho=this.objOrtho,window.objOrthoVR=this.objOrthoVR}},{key:"toggle",value:function(){"normal"==this.mode?(this.mode="vr",null!=this.scene&&(this.scene.activeCameras[0]=this.objVR,this.scene.activeCameras[1]=this.objOrthoVR,this.cursor.position.z=30,this.glitchEnabled)):(this.mode="normal",null!=this.scene&&(this.scene.activeCameras[0]=this.obj,this.scene.activeCameras[1]=this.objOrtho,this.cursor.position.z=100))}},{key:"readDeviceOrientation",value:function(){90===Math.abs(window.orientation)?(this.toggleCanvas("block"),null==this.objVR&&this.initVR(),this.landscapeMode=!0,this.rotationModal&&(this.modal.style.display="none")):(this.toggleCanvas(),this.rotationModal&&(this.modal.style.display="block"),this.landscapeMode=!1),this.setCanvasTouch(),this.scene.getEngine().resize()}},{key:"toggleCanvas",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"none":arguments[0];document.querySelector(".vr-button").style.display=t}},{key:"rayPick",value:function(){this.pickResult=this.scene.pick(this.scene.pointerX,this.scene.pointerY)}},{key:"setCanvasTouch",value:function(){for(var t=0;t<this.canvasList.length;t++)this.canvasList[t].setAttribute("touch-action","none"),this.canvasList[t].style.width="",this.canvasList[t].style.height="",this.canvasList[t].height=document.documentElement.clientHeight,this.canvasList[t].width=document.documentElement.clientWidth}},{key:"setListners",value:function(){this.setCanvasTouch(),document.querySelector(".vr-button").addEventListener("click",this.toggle.bind(this)),window.addEventListener("orientationchange",this.readDeviceOrientation.bind(this),!1),window.addEventListener("resize",function(){this.setCanvasTouch(),this.scene.getEngine().resize()}.bind(this))}}]),t}();exports.c_cameravr=c_cameravr;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvbHNkL2NvbXBvbmVudHMvY19jYW1lcmF2ci5qcyJdLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIm9iaiIsIl9fZXNNb2R1bGUiLCJuZXdPYmoiLCJrZXkiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsIl9jZXMiLCJyZXF1aXJlIiwiQ0VTIiwiX3V0aWxzVXRpbHMiLCJfbGliQmFieWxvbiIsImdldCIsIkJBQllMT04iLCJkZWZhdWx0cyIsInV0aWxzIiwiZGVmYXVsdEFyZ3MiLCJfbmFtZSIsImNfY2FtZXJhdnIiLCJfb3B0cyIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsInRoaXMiLCJyb3RhdGlvbk1vZGFsIiwiX2hhc01vZGFsIiwibW9kYWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzdHlsZSIsImRpc3BsYXkiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJjdXJzb3JFbnQiLCJjdXJzb3IiLCJfY3Vyc29yIiwiY3Vyc29yVlIxIiwiX2N1cnNvclZSMSIsImN1cnNvclZSMiIsIl9jdXJzb3JWUjIiLCJjYW52YXNMaXN0IiwibmFtZSIsIm9wdHMiLCJvYmpWUiIsIm9iak9ydGhvVlIiLCJvYmpPcnRobyIsInNjZW5lIiwiX3NjZW5lIiwiY2FudmFzIiwiX2NhbnZhcyIsIm9uZUF4aXMiLCJtb2RlIiwiZnBzVUlXaW5kb3ciLCJmcHNVSSIsIl9mcHNVSSIsImh1ZCIsImdsaXRjaEVuYWJsZWQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiQXJyYXkiLCJmcm9tIiwiTWF0aCIsImFicyIsIndpbmRvdyIsIm9yaWVudGF0aW9uIiwiQ0FUQU1BUkFOIiwiaXNNb2JpbGUiLCJ0b2dnbGVDYW52YXMiLCJpbml0VlIiLCJzZXRMaXN0bmVycyIsIm9wdGlvbnMiLCJpbml0IiwiY29uc3RydWN0b3IiLCJDb21wb25lbnQiLCJleHRlbmQiLCJGcmVlQ2FtZXJhIiwiVmVjdG9yMyIsIlplcm8iLCJzZXRUYXJnZXQiLCJsYXllck1hc2siLCJfYWN0aXZlRGlhbG9nTGF5ZXIiLCJWaXJ0dWFsSm95c3RpY2tzQ2FtZXJhIiwiX3Bvc2l0aW9uIiwiYXR0YWNoQ29udHJvbCIsImluZXJ0aWFTcGVlZCIsIl9tb2JpbGVPUyIsInJvdGF0aW9uU3BlZWQiLCJpbnB1dHMiLCJhdHRhY2hlZCIsInZpcnR1YWxKb3lzdGljayIsIl9yaWdodGpveXN0aWNrIiwicmV2ZXJzZVVwRG93biIsIl9yb3RhdGVPbkF4aXNSZWxhdGl2ZVRvTWVzaCIsImNhbWVyYSIsImluZXJ0aWEiLCJfaW52ZXJzZVJvdGF0aW9uU3BlZWQiLCJfcm90YXRpb25TcGVlZCIsIl9heGlzVGFyZ2V0ZWRCeVVwQW5kRG93biIsIl9heGlzVGFyZ2V0ZWRCeUxlZnRBbmRSaWdodCIsIl9sZWZ0am95c3RpY2siLCJWUkRldmljZU9yaWVudGF0aW9uRnJlZUNhbWVyYSIsImNoZWNrQ29sbGlzaW9ucyIsImFwcGx5R3Jhdml0eSIsIldlYlZSRnJlZUNhbWVyYSIsIl9yaWdDYW1lcmFzIiwicG9zaXRpb24iLCJzZXRDYW52YXNUb3VjaCIsImUiLCJjb25zb2xlIiwibG9nIiwiYWN0aXZlQ2FtZXJhcyIsInB1c2giLCJhY3RpdmVDYW1lcmEiLCJwaWNrUmVzdWx0IiwiYm9keUVMIiwiY29yZSIsIkRPTSIsIm9wZW4iLCJhcHBlbmQiLCJkZWJ1ZyIsInoiLCJsYW5kc2NhcGVNb2RlIiwiZ2V0RW5naW5lIiwicmVzaXplIiwiX21vZGUiLCJxdWVyeVNlbGVjdG9yIiwicGljayIsInBvaW50ZXJYIiwicG9pbnRlclkiLCJzZXRBdHRyaWJ1dGUiLCJ3aWR0aCIsImhlaWdodCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudEhlaWdodCIsImNsaWVudFdpZHRoIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRvZ2dsZSIsImJpbmQiLCJyZWFkRGV2aWNlT3JpZW50YXRpb24iXSwibWFwcGluZ3MiOiJBQUFBLFlBUUEsU0FBU0EseUJBQXdCQyxHQUFPLEdBQUlBLEdBQU9BLEVBQUlDLFdBQWMsTUFBT0QsRUFBYyxJQUFJRSxLQUFhLElBQVcsTUFBUEYsRUFBZSxJQUFLLEdBQUlHLEtBQU9ILEdBQVdJLE9BQU9DLFVBQVVDLGVBQWVDLEtBQUtQLEVBQUtHLEtBQU1ELEVBQU9DLEdBQU9ILEVBQUlHLEdBQW1DLE9BQXpCRCxHQUFPLFdBQWFGLEVBQVlFLEVBRXJRLFFBQVNNLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQVJoSFAsT0FBT1EsZUFBZUMsUUFBUyxjQUM3QkMsT0FBTyxHQUdULElBQUlDLGNBQWUsV0FBZSxRQUFTQyxHQUFpQkMsRUFBUUMsR0FBUyxJQUFLLEdBQUlDLEdBQUksRUFBR0EsRUFBSUQsRUFBTUUsT0FBUUQsSUFBSyxDQUFFLEdBQUlFLEdBQWFILEVBQU1DLEVBQUlFLEdBQVdDLFdBQWFELEVBQVdDLGFBQWMsRUFBT0QsRUFBV0UsY0FBZSxFQUFVLFNBQVdGLEtBQVlBLEVBQVdHLFVBQVcsR0FBTXBCLE9BQU9RLGVBQWVLLEVBQVFJLEVBQVdsQixJQUFLa0IsSUFBaUIsTUFBTyxVQUFVWCxFQUFhZSxFQUFZQyxHQUFpSixNQUE5SEQsSUFBWVQsRUFBaUJOLEVBQVlMLFVBQVdvQixHQUFpQkMsR0FBYVYsRUFBaUJOLEVBQWFnQixHQUFxQmhCLE1BTTdoQmlCLEtBQU9DLFFBWlUsT0FBVEMsSUFBRzlCLHdCQUFBNEIsTUFnQlhHLFlBQWNGLFFBZEksa0JB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QUFHb0ksT0FBU3pHLFNBQVMwRyxnQkFBZ0JDLGFBQ3JEL0csS0FBS21CLFdBQVcxQyxHQUFHbUksTUFBUXhHLFNBQVMwRyxnQkFBZ0JFLGVBd0MxRHZKLElBQUssY0FDTFcsTUFyQ2EsV0FDVjRCLEtBQUtvRixpQkFDTGhGLFNBQVNtRyxjQUFjLGNBQWNVLGlCQUFpQixRQUFTakgsS0FBS2tILE9BQU9DLEtBQUtuSCxPQUVsRnlDLE9BQU93RSxpQkFBaUIsb0JBQXFCakgsS0FBS29ILHNCQUFzQkQsS0FBS25ILE9BQU8sR0FDcEZ5QyxPQUFPd0UsaUJBQWlCLFNBQVUsV0FDaENqSCxLQUFLb0YsaUJBQ0xwRixLQUFLeUIsTUFBTTJFLFlBQVlDLFVBQ3ZCYyxLQUFLbkgsV0E5TEVKLElBME9kekIsU0FBUXlCLFdBQWFBIiwiZmlsZSI6ImNvcmUvbHNkL2NvbXBvbmVudHMvY19jYW1lcmF2ci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIENFUyBmcm9tICdjZXMnO1xuZXhwb3J0IHsgQkFCWUxPTiB9IGZyb20gJy4uL2xpYi9iYWJ5bG9uJztcbmltcG9ydCB7IHV0aWxzIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xudmFyIGRlZmF1bHRzID0gdXRpbHMuZGVmYXVsdEFyZ3MoKTtcbmRlZmF1bHRzLl9uYW1lID0gJ2NhbWVyYSc7XG4vKipcbiAqIC4uLlxuICogQGF1dGhvciBCcmVuZG9uIFNtaXRoXG4gKiBodHRwOi8vc2VhY2xvdWQ5Lm9yZ1xuICogTGlnaHRXZWlnaHQgM0QgU3lzdGVtIERlc2lnbiBlbmdpbmVcbiAqL1xuIGV4cG9ydCBjbGFzcyBjX2NhbWVyYXZyIHtcbiAgIGNvbnN0cnVjdG9yKF9vcHRzID0gZGVmYXVsdHMpe1xuICAgIHRoaXMucm90YXRpb25Nb2RhbCA9IF9vcHRzLl9oYXNNb2RhbDtcbiAgICBpZih0aGlzLnJvdGF0aW9uTW9kYWwpe1xuICAgICAgdGhpcy5tb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QuYWRkKCdhLW9yaWVudGF0aW9uLW1vZGFsJyk7XG4gICAgICB0aGlzLm1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubW9kYWwpO1xuICAgIH1cbiAgICBcbiAgICB0aGlzLmN1cnNvckVudCA9IG51bGw7XG4gICAgdGhpcy5jdXJzb3IgPSBfb3B0cy5fY3Vyc29yO1xuICAgIHRoaXMuY3Vyc29yVlIxID0gX29wdHMuX2N1cnNvclZSMTtcbiAgICB0aGlzLmN1cnNvclZSMiA9IF9vcHRzLl9jdXJzb3JWUjI7XG4gICAgdGhpcy5jYW52YXNMaXN0ID0gbnVsbDtcbiAgICB0aGlzLm5hbWUgPSBfb3B0cy5fbmFtZTtcbiAgICB0aGlzLm9wdHMgPSBfb3B0cztcbiAgICB0aGlzLm9iajtcbiAgICB0aGlzLm9ialZSID0gbnVsbDtcbiAgICB0aGlzLm9iak9ydGhvVlIgPSBudWxsO1xuICAgIHRoaXMub2JqT3J0aG8gPSBudWxsO1xuICAgIHRoaXMuc2NlbmUgPSAgX29wdHMuX3NjZW5lO1xuICAgIHRoaXMuY2FudmFzID0gX29wdHMuX2NhbnZhcztcbiAgICB0aGlzLm9uZUF4aXMgPSB0cnVlO1xuICAgIHRoaXMubW9kZSA9ICdub3JtYWwnO1xuICAgIHRoaXMuZnBzVUlXaW5kb3cgPSBudWxsO1xuICAgIHRoaXMuZnBzVUkgPSBfb3B0cy5fZnBzVUk7XG4gICAgdGhpcy5odWQgID0gbnVsbDtcbiAgICB0aGlzLmdsaXRjaEVuYWJsZWQgPSBmYWxzZTtcbiAgICB2YXIgY2FudmFzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2NhbnZhcycpO1xuICAgIHRoaXMuY2FudmFzTGlzdCA9IEFycmF5LmZyb20oY2FudmFzTGlzdCk7XG4gICAgaWYoTWF0aC5hYnMod2luZG93Lm9yaWVudGF0aW9uKSA9PT0gOTAgfHwgIUNBVEFNQVJBTi5pc01vYmlsZSgpKXtcbiAgICAgdGhpcy50b2dnbGVDYW52YXMoJ2Jsb2NrJyk7XG4gICAgIHRoaXMuaW5pdFZSKCk7XG4gICB9ZWxzZXtcbiAgICAgdGhpcy50b2dnbGVDYW52YXMoKTtcbiAgICAgaWYodGhpcy5yb3RhdGlvbk1vZGFsKXtcbiAgICAgIHRoaXMubW9kYWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgIH1cbiAgICAgXG4gICB9XG4gICB0aGlzLnNldExpc3RuZXJzKCk7XG4gICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgIG5hbWU6dGhpcy5uYW1lLFxuICAgICBpbml0OiB0aGlzLmNvbnN0cnVjdG9yLFxuICAgICBvYmo6dGhpcy5vYmosXG4gICAgIG9iak9ydGhvOnRoaXMub2JqT3J0aG8sXG4gICAgIG9iak9ydGhvVlI6IHRoaXMub2JqT3J0aG9WUixcbiAgICAgb2JqVlI6dGhpcy5vYmpWUlxuICAgfVxuICAgQ0VTLkNvbXBvbmVudC5leHRlbmQodGhpcy5vcHRpb25zKTtcbiB9XG5cbiBpbml0VlIoKXtcbiAgdGhpcy5vYmpPcnRobyAgPSBuZXcgQkFCWUxPTi5GcmVlQ2FtZXJhKFwiRnJlZUNhbWVyYVwiLCBCQUJZTE9OLlZlY3RvcjMuWmVybygpLCB0aGlzLm9wdHMuX3NjZW5lICk7XG5cdFx0Ly90aGlzLm9iak9ydGhvLm1vZGUgPSBCQUJZTE9OLkNhbWVyYS5PUlRIT0dSQVBISUNfQ0FNRVJBO1xuXHRcdC8vdGhpcy5vYmpPcnRoby5hdHRhY2hDb250cm9sKHRoaXMuY2FudmFzLCBmYWxzZSk7XG5cdFx0dGhpcy5vYmpPcnRoby5zZXRUYXJnZXQoQkFCWUxPTi5WZWN0b3IzLlplcm8oKSk7XG5cdFx0dGhpcy5vYmpPcnRoby5sYXllck1hc2sgPSB0aGlzLm9wdHMuX2FjdGl2ZURpYWxvZ0xheWVyO1xuXHRcdHRoaXMub2JqID0gbmV3IEJBQllMT04uVmlydHVhbEpveXN0aWNrc0NhbWVyYShcIlZKQ2FtZXJhXCIsIHRoaXMub3B0cy5fcG9zaXRpb24sIHRoaXMuc2NlbmUpO1xuICAgIHRoaXMub2JqLmF0dGFjaENvbnRyb2wodGhpcy5jYW52YXMsIGZhbHNlKTtcbiAgICB0cnl7XG4gICAgICBDQVRBTUFSQU4uaXNNb2JpbGUoKTtcbiAgICAgIHRoaXMuaW5lcnRpYVNwZWVkICA9IENBVEFNQVJBTi5fbW9iaWxlT1MgPT0gJ0FuZHJvaWQnID8gMC42IDogMC43O1xuICAgICAgdGhpcy5yb3RhdGlvblNwZWVkICA9IENBVEFNQVJBTi5fbW9iaWxlT1MgPT0gJ0FuZHJvaWQnPyA0IDogMjtcbiAgICAgIHRoaXMub2JqLmlucHV0cy5hdHRhY2hlZC52aXJ0dWFsSm95c3RpY2suX3JpZ2h0am95c3RpY2sucmV2ZXJzZVVwRG93biA9IHRydWU7XG4gICAgICB0aGlzLm9iai5pbnB1dHMuYXR0YWNoZWQudmlydHVhbEpveXN0aWNrLl9yaWdodGpveXN0aWNrLl9yb3RhdGVPbkF4aXNSZWxhdGl2ZVRvTWVzaCA9IHRydWU7XG4gICAgICB0aGlzLm9iai5pbnB1dHMuYXR0YWNoZWQudmlydHVhbEpveXN0aWNrLmNhbWVyYS5pbmVydGlhID0gdGhpcy5pbmVydGlhU3BlZWQ7XG4gICAgICB0aGlzLm9iai5pbnB1dHMuYXR0YWNoZWQudmlydHVhbEpveXN0aWNrLl9yaWdodGpveXN0aWNrLl9pbnZlcnNlUm90YXRpb25TcGVlZCA9IHRoaXMucm90YXRpb25TcGVlZDtcbiAgICAgIHRoaXMub2JqLmlucHV0cy5hdHRhY2hlZC52aXJ0dWFsSm95c3RpY2suX3JpZ2h0am95c3RpY2suX3JvdGF0aW9uU3BlZWQgPSB0aGlzLnJvdGF0aW9uU3BlZWQ7XG4gICAgICBpZih0aGlzLm9uZUF4aXMpe1xuICAgICAgIHRoaXMub2JqLmlucHV0cy5hdHRhY2hlZC52aXJ0dWFsSm95c3RpY2suX3JpZ2h0am95c3RpY2suX2F4aXNUYXJnZXRlZEJ5VXBBbmREb3duID0gMztcbiAgICAgICB0aGlzLm9iai5pbnB1dHMuYXR0YWNoZWQudmlydHVhbEpveXN0aWNrLl9yaWdodGpveXN0aWNrLl9heGlzVGFyZ2V0ZWRCeUxlZnRBbmRSaWdodCA9IDE7XG4gICAgICAgdGhpcy5vYmouaW5wdXRzLmF0dGFjaGVkLnZpcnR1YWxKb3lzdGljay5fbGVmdGpveXN0aWNrLl9heGlzVGFyZ2V0ZWRCeVVwQW5kRG93biA9IDI7XG4gICAgICAgdGhpcy5vYmouaW5wdXRzLmF0dGFjaGVkLnZpcnR1YWxKb3lzdGljay5fbGVmdGpveXN0aWNrLl9heGlzVGFyZ2V0ZWRCeUxlZnRBbmRSaWdodCA9IDA7XG4gICAgIH1cbiAgICAgdGhpcy5vYmpWUiAgPSBuZXcgQkFCWUxPTi5WUkRldmljZU9yaWVudGF0aW9uRnJlZUNhbWVyYShcIlZSQ2FtZXJhXCIsICB0aGlzLm9wdHMuX3Bvc2l0aW9uLCB0aGlzLnNjZW5lLCBmYWxzZSk7XG4gICAgIHRoaXMub2JqVlIuY2hlY2tDb2xsaXNpb25zID0gZmFsc2U7XG4gICAgIHRoaXMub2JqVlIuYXBwbHlHcmF2aXR5ID0gZmFsc2U7XG4gICAgIHRoaXMub2JqVlIuYXR0YWNoQ29udHJvbCh0aGlzLmNhbnZhcyAsIHRydWUpO1xuICAgICB0aGlzLm9iak9ydGhvVlIgID0gbmV3IEJBQllMT04uV2ViVlJGcmVlQ2FtZXJhKFwiVlJDYW1lcmEyXCIsIG5ldyBCQUJZTE9OLlZlY3RvcjMuWmVybygpLCAgdGhpcy5zY2VuZSwgZmFsc2UpO1xuICAgICB0aGlzLm9iak9ydGhvVlIuc2V0VGFyZ2V0KEJBQllMT04uVmVjdG9yMy5aZXJvKCkpO1xuICAgICB0aGlzLm9iak9ydGhvVlIubGF5ZXJNYXNrID0gdGhpcy5vcHRzLl9hY3RpdmVEaWFsb2dMYXllcjtcbiAgICAgdGhpcy5vYmpPcnRob1ZSLl9yaWdDYW1lcmFzWzBdLmxheWVyTWFzayA9ICB0aGlzLm9wdHMuX2FjdGl2ZURpYWxvZ0xheWVyO1xuICAgICB0aGlzLm9iak9ydGhvVlIuX3JpZ0NhbWVyYXNbMV0ubGF5ZXJNYXNrID0gIHRoaXMub3B0cy5fYWN0aXZlRGlhbG9nTGF5ZXI7XG4gICAgIHRoaXMub2JqVlIucG9zaXRpb24gPSB0aGlzLm9iai5wb3NpdGlvbjtcbiAgICAgdmFyIGNhbnZhc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdjYW52YXMnKTtcbiAgICAgdGhpcy5jYW52YXNMaXN0ID0gQXJyYXkuZnJvbShjYW52YXNMaXN0KTtcbiAgICAgdGhpcy5zZXRDYW52YXNUb3VjaCgpO1xuICAgfWNhdGNoKGUpe1xuICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgY29uc29sZS5sb2coJ3JlcXVpcmVzIC0+IGh0dHBzOi8vY29kZS5qcXVlcnkuY29tL3BlcC8wLjQuMS9wZXAuanMnKTtcbiAgIH1cbiAgIHRoaXMuc2NlbmUuYWN0aXZlQ2FtZXJhcy5wdXNoKHRoaXMub2JqKTtcbiAgIHRoaXMuc2NlbmUuYWN0aXZlQ2FtZXJhcy5wdXNoKHRoaXMub2JqT3J0aG8pO1xuICAgdGhpcy5zY2VuZS5hY3RpdmVDYW1lcmEgPSB0aGlzLm9iajtcbiAgIHRoaXMucGlja1Jlc3VsdCA9IG51bGw7XG5cbiAgIGlmKHRoaXMuZnBzVUkpe1xuICAgIHRoaXMuYm9keUVMID0gIG5ldyBDQVRBTUFSQU4uY29yZS5ET00oJ2JvZHknKTtcbiAgICB0aGlzLmZwc1VJV2luZG93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImZwc3dpbmRvd1wiKTtcbiAgICB0aGlzLmZwc1VJV2luZG93Lm9wZW4gPSB0cnVlO1xuICAgIHRoaXMuZnBzVUlXaW5kb3cuY2xhc3NMaXN0LmFkZCgnZnBzVUlXaW5kb3cnKTtcbiAgICB0aGlzLmJvZHlFTC5hcHBlbmQoIHRoaXMuZnBzVUlXaW5kb3cgKTtcbiAgICB0aGlzLmZwc1VJV2luZG93ID0gbmV3IENBVEFNQVJBTi5jb3JlLkRPTSgnLmZwc1VJV2luZG93Jyk7XG4gIH1cbiAgaWYoQ0FUQU1BUkFOLmRlYnVnKXtcbiAgIHRoaXMuZGVidWcoKTtcbiB9XG59XG5cbmRlYnVnKCl7XG4gIHdpbmRvdy5vYmpWUiA9IHRoaXMub2JqVlI7XG4gIHdpbmRvdy5vYmogPSB0aGlzLm9iajtcbiAgd2luZG93Lm9iak9ydGhvID0gdGhpcy5vYmpPcnRobztcbiAgd2luZG93Lm9iak9ydGhvVlIgPSB0aGlzLm9iak9ydGhvVlI7XG59XG5cbnRvZ2dsZSgpIHtcbiAgaWYgKHRoaXMubW9kZSA9PSAnbm9ybWFsJykge1xuICAgIHRoaXMubW9kZSA9ICd2cic7XG4gICAgaWYgKHRoaXMuc2NlbmUgIT0gbnVsbCkge1xuICAgICB0aGlzLnNjZW5lLmFjdGl2ZUNhbWVyYXNbMF0gPSB0aGlzLm9ialZSO1xuICAgICB0aGlzLnNjZW5lLmFjdGl2ZUNhbWVyYXNbMV0gPSB0aGlzLm9iak9ydGhvVlI7XG4gICAgIHRoaXMuY3Vyc29yLnBvc2l0aW9uLnogPSAzMDtcbiAgICAgaWYodGhpcy5nbGl0Y2hFbmFibGVkKXtcbiAgICAgICAgICAgICAgICAgICAgXHQvL2Z4XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlID0gJ25vcm1hbCc7XG4gICAgICAgICAgICAgICAgICBpZiAodGhpcy5zY2VuZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hY3RpdmVDYW1lcmFzWzBdID0gdGhpcy5vYmo7XG4gICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hY3RpdmVDYW1lcmFzWzFdID0gdGhpcy5vYmpPcnRobztcbiAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnNvci5wb3NpdGlvbi56ID0gMTAwO1xuICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgcmVhZERldmljZU9yaWVudGF0aW9uKCkge1xuICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMod2luZG93Lm9yaWVudGF0aW9uKSA9PT0gOTApIHtcbiAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlQ2FudmFzKCdibG9jaycpO1xuICAgICAgICAgICAgICAgaWYodGhpcy5vYmpWUiA9PSBudWxsKXtcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRWUigpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRoaXMubGFuZHNjYXBlTW9kZSA9IHRydWU7XG4gICAgICAgICAgICAgIGlmKHRoaXMucm90YXRpb25Nb2RhbCl7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgdGhpcy50b2dnbGVDYW52YXMoKTtcbiAgICAgICAgICAgICAgIGlmKHRoaXMucm90YXRpb25Nb2RhbCl7XG4gICAgICAgICAgICAgICAgICB0aGlzLm1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIHRoaXMubGFuZHNjYXBlTW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgIFxuICAgICAgICAgICB9XG4gICAgICAgICAgIHRoaXMuc2V0Q2FudmFzVG91Y2goKTtcbiAgICAgICAgICAgdGhpcy5zY2VuZS5nZXRFbmdpbmUoKS5yZXNpemUoKTtcblxuICAgICAgICAgfVxuXG4gICAgICAgICB0b2dnbGVDYW52YXMoX21vZGUgPSAnbm9uZScpe1xuICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudnItYnV0dG9uJykuc3R5bGUuZGlzcGxheSA9IF9tb2RlO1xuICAgICAgICAgfVxuXG4gICAgICAgICByYXlQaWNrKCl7XG4gICAgICAgICAgIHRoaXMucGlja1Jlc3VsdCA9IHRoaXMuc2NlbmUucGljayh0aGlzLnNjZW5lLnBvaW50ZXJYLCB0aGlzLnNjZW5lLnBvaW50ZXJZKTtcbiAgXHQgXHQgICAgIC8vY29uc29sZS5sb2codGhpcy5waWNrUmVzdWx0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNldENhbnZhc1RvdWNoKCl7XG4gICAgICAgICBmb3IobGV0IGk9MDsgaSA8IHRoaXMuY2FudmFzTGlzdC5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgdGhpcy5jYW52YXNMaXN0W2ldLnNldEF0dHJpYnV0ZShcInRvdWNoLWFjdGlvblwiLCAnbm9uZScpO1xuICAgICAgICAgIHRoaXMuY2FudmFzTGlzdFtpXS5zdHlsZS53aWR0aCA9ICcnO1xuICAgICAgICAgIHRoaXMuY2FudmFzTGlzdFtpXS5zdHlsZS5oZWlnaHQgPSAnJztcbiAgICAgICAgICB0aGlzLmNhbnZhc0xpc3RbaV0uaGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICAgICAgICB0aGlzLmNhbnZhc0xpc3RbaV0ud2lkdGggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgc2V0TGlzdG5lcnMoKXtcbiAgICAgICB0aGlzLnNldENhbnZhc1RvdWNoKCk7XG4gICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZyLWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy50b2dnbGUuYmluZCh0aGlzKSk7XG4gICAgXHQvL3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMucmF5UGljay5iaW5kKHRoaXMpKTtcbiAgICBcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMucmVhZERldmljZU9yaWVudGF0aW9uLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICBcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICB0aGlzLnNldENhbnZhc1RvdWNoKCk7XG4gICAgICAgdGhpcy5zY2VuZS5nZXRFbmdpbmUoKS5yZXNpemUoKTtcbiAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIH1cbiAgICBcblxuICB9Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9