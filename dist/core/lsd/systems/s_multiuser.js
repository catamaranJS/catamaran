"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),_get=function(t,e,i){for(var r=!0;r;){var s=t,n=e,o=i;r=!1,null===s&&(s=Function.prototype);var a=Object.getOwnPropertyDescriptor(s,n);if(void 0!==a){if("value"in a)return a.value;var u=a.get;return void 0===u?void 0:u.call(o)}var l=Object.getPrototypeOf(s);if(null===l)return void 0;t=l,e=n,i=o,r=!0,a=l=void 0}},CES=require("CES"),BABYLON=require("../lib/babylon"),s_multiuser=function(t){function e(t){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this._opts=t,this._entity=null,this._zombieModeEnabled=!1}return _inherits(e,t),_createClass(e,[{key:"update",value:function(t){var e=this.world.getEntities("multiuser");e.forEach(function(t){if(this._entity=t._components.$multiuser,this.world._multiuserInit=this._entity.sysInit,this.world._crurrentScene.activeCamera&&this._entity.sysInit&&this._entity.userInit){this._entity.updateUser(this.world._crurrentScene.activeCameras[0].position,this.world._crurrentScene.activeCameras[0].rotation);for(var e=0;e<this._entity.currentUsers.length;e++)this._entity.currentUsers[e].key!=this._entity.currentUserKey&&(this.spriteDoesNotExist(this._entity.currentUsers[e].key,this._entity.sprites)?(this._zombieModeEnabled=this._entity.zombieMode?!0:!1,this.updateUserSprites(this._entity.currentUsers[e])):this._entity.generateUserSprites(this._entity.currentUsers[e],e))}}.bind(this))}},{key:"spriteDoesNotExist",value:function(t,e){for(var i=!1,r=0;r<e.length;r++)if(e[r].key==t)return i=!0;return i}},{key:"updateUserSprites",value:function(t){for(var e=0;e<this._entity.sprites.length;e++)if(void 0!=this._entity.sprites[e].key&&t.key==this._entity.sprites[e].key){this._entity.zombieMode?this._entity.sprites[e].sprite.playAnimation(80,100,!0,100):this._zombieModeEnabled&&this._entity.sprites[e].sprite.playAnimation(Math.abs(20-parseInt(t.data.spriteID)),parseInt(t.data.spriteID),!0,100),this._entity.sprites[e].sprite.position=t.data.position;break}}}]),e}(CES.System);module.exports=s_multiuser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvbHNkL3N5c3RlbXMvc19tdWx0aXVzZXIuanMiXSwibmFtZXMiOlsiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9pbmhlcml0cyIsInN1YkNsYXNzIiwic3VwZXJDbGFzcyIsInByb3RvdHlwZSIsIk9iamVjdCIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwidmFsdWUiLCJlbnVtZXJhYmxlIiwid3JpdGFibGUiLCJjb25maWd1cmFibGUiLCJzZXRQcm90b3R5cGVPZiIsIl9fcHJvdG9fXyIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJfZ2V0IiwiX3giLCJfeDIiLCJfeDMiLCJfYWdhaW4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInJlY2VpdmVyIiwiRnVuY3Rpb24iLCJkZXNjIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwidW5kZWZpbmVkIiwiZ2V0dGVyIiwiZ2V0IiwiY2FsbCIsInBhcmVudCIsImdldFByb3RvdHlwZU9mIiwiQ0VTIiwicmVxdWlyZSIsIkJBQllMT04iLCJzX211bHRpdXNlciIsIl9DRVMkU3lzdGVtIiwiX29wdHMiLCJ0aGlzIiwiX2VudGl0eSIsIl96b21iaWVNb2RlRW5hYmxlZCIsImR0IiwiZW50aXRpZXMiLCJ3b3JsZCIsImdldEVudGl0aWVzIiwiZm9yRWFjaCIsImVudGl0eSIsIl9jb21wb25lbnRzIiwiJG11bHRpdXNlciIsIl9tdWx0aXVzZXJJbml0Iiwic3lzSW5pdCIsIl9jcnVycmVudFNjZW5lIiwiYWN0aXZlQ2FtZXJhIiwidXNlckluaXQiLCJ1cGRhdGVVc2VyIiwiYWN0aXZlQ2FtZXJhcyIsInBvc2l0aW9uIiwicm90YXRpb24iLCJjdXJyZW50VXNlcnMiLCJjdXJyZW50VXNlcktleSIsInNwcml0ZURvZXNOb3RFeGlzdCIsInNwcml0ZXMiLCJ6b21iaWVNb2RlIiwidXBkYXRlVXNlclNwcml0ZXMiLCJnZW5lcmF0ZVVzZXJTcHJpdGVzIiwiYmluZCIsImFycmF5IiwiZm91bmQiLCJfZGF0YSIsInNwcml0ZSIsInBsYXlBbmltYXRpb24iLCJNYXRoIiwiYWJzIiwicGFyc2VJbnQiLCJkYXRhIiwic3ByaXRlSUQiLCJTeXN0ZW0iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxZQU1BLFNBQVNBLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQUVoSCxRQUFTQyxXQUFVQyxFQUFVQyxHQUFjLEdBQTBCLGtCQUFmQSxJQUE0QyxPQUFmQSxFQUF1QixLQUFNLElBQUlILFdBQVUsaUVBQW9FRyxHQUFlRCxHQUFTRSxVQUFZQyxPQUFPQyxPQUFPSCxHQUFjQSxFQUFXQyxXQUFhRyxhQUFlQyxNQUFPTixFQUFVTyxZQUFZLEVBQU9DLFVBQVUsRUFBTUMsY0FBYyxLQUFlUixJQUFZRSxPQUFPTyxlQUFpQlAsT0FBT08sZUFBZVYsRUFBVUMsR0FBY0QsRUFBU1csVUFBWVYsR0FOamUsR0FBSVcsY0FBZSxXQUFlLFFBQVNDLEdBQWlCQyxFQUFRQyxHQUFTLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRCxFQUFNRSxPQUFRRCxJQUFLLENBQUUsR0FBSUUsR0FBYUgsRUFBTUMsRUFBSUUsR0FBV1gsV0FBYVcsRUFBV1gsYUFBYyxFQUFPVyxFQUFXVCxjQUFlLEVBQVUsU0FBV1MsS0FBWUEsRUFBV1YsVUFBVyxHQUFNTCxPQUFPZ0IsZUFBZUwsRUFBUUksRUFBV0UsSUFBS0YsSUFBaUIsTUFBTyxVQUFVckIsRUFBYXdCLEVBQVlDLEdBQWlKLE1BQTlIRCxJQUFZUixFQUFpQmhCLEVBQVlLLFVBQVdtQixHQUFpQkMsR0FBYVQsRUFBaUJoQixFQUFheUIsR0FBcUJ6QixNQUU3aEIwQixLQUFPLFNBQWFDLEVB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UUFBUXNCLFFBQVFyRCxHQUFHNkQsT0FBT0MsY0FBY0MsS0FBS0MsSUFBSyxHQUFLQyxTQUFTTCxFQUFNTSxLQUFLQyxXQUFhRixTQUFTTCxFQUFNTSxLQUFLQyxXQUFXLEVBQU0sS0FHMUlyQyxLQUFLQyxRQUFRc0IsUUFBUXJELEdBQUc2RCxPQUFPYixTQUFZWSxFQUFNTSxLQUFLbEIsUUFDdEQsWUF6RFRyQixHQUFvQkgsSUFBSTRDLE9BK0QvQkMsUUFBT0MsUUFBVTNDIiwiZmlsZSI6ImNvcmUvbHNkL3N5c3RlbXMvc19tdWx0aXVzZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBDRVMgPSByZXF1aXJlKCdDRVMnKTtcbnZhciBCQUJZTE9OID0gcmVxdWlyZSgnLi4vbGliL2JhYnlsb24nKTtcblxuLyoqXG4gKiAuLi5cbiAqIEBhdXRob3IgQnJlbmRvbiBTbWl0aFxuICogaHR0cDovL3NlYWNsb3VkOS5vcmdcbiAqIExpZ2h0V2VpZ2h0IDNEIFN5c3RlbSBEZXNpZ24gZW5naW5lXG4gKi9cbiBjbGFzcyBzX211bHRpdXNlciBleHRlbmRzIENFUy5TeXN0ZW17XG4gICAgY29uc3RydWN0b3IoX29wdHMpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9vcHRzID0gX29wdHM7XG4gICAgICAgIHRoaXMuX2VudGl0eSA9IG51bGw7XG4gICAgICAgIHRoaXMuX3pvbWJpZU1vZGVFbmFibGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdXBkYXRlKGR0KXtcbiAgICAgIHZhciBlbnRpdGllcyA9IHRoaXMud29ybGQuZ2V0RW50aXRpZXMoJ211bHRpdXNlcicpO1xuICAgICAgZW50aXRpZXMuZm9yRWFjaChmdW5jdGlvbiAoZW50aXR5KSB7XG4gICAgICAgIHRoaXMuX2VudGl0eSAgPSBlbnRpdHkuX2NvbXBvbmVudHMuJG11bHRpdXNlcjtcbiAgICAgICAgdGhpcy53b3JsZC5fbXVsdGl1c2VySW5pdCA9IHRoaXMuX2VudGl0eS5zeXNJbml0O1xuICAgICAgICBpZih0aGlzLndvcmxkLl9jcnVycmVudFNjZW5lLmFjdGl2ZUNhbWVyYSAmJiB0aGlzLl9lbnRpdHkuc3lzSW5pdCAmJiB0aGlzLl9lbnRpdHkudXNlckluaXQpe1xuICAgICAgICAgICAgdGhpcy5fZW50aXR5LnVwZGF0ZVVzZXIodGhpcy53b3JsZC5fY3J1cnJlbnRTY2VuZS5hY3RpdmVDYW1lcmFzWzBdLnBvc2l0aW9uLCB0aGlzLndvcmxkLl9jcnVycmVudFNjZW5lLmFjdGl2ZUNhbWVyYXNbMF0ucm90YXRpb24pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5fZW50aXR5LmN1cnJlbnRVc2Vycy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5fZW50aXR5LmN1cnJlbnRVc2Vyc1tpXS5rZXkgIT0gdGhpcy5fZW50aXR5LmN1cnJlbnRVc2VyS2V5KXtcbiAgICAgICAgICAgICAgICAgICAgaWYoISB0aGlzLnNwcml0ZURvZXNOb3RFeGlzdCh0aGlzLl9lbnRpdHkuY3VycmVudFVzZXJzW2ldLmtleSwgdGhpcy5fZW50aXR5LnNwcml0ZXMpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VudGl0eS5nZW5lcmF0ZVVzZXJTcHJpdGVzKHRoaXMuX2VudGl0eS5jdXJyZW50VXNlcnNbaV0sIGkpO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuX2VudGl0eS56b21iaWVNb2RlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl96b21iaWVNb2RlRW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl96b21iaWVNb2RlRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVVc2VyU3ByaXRlcyh0aGlzLl9lbnRpdHkuY3VycmVudFVzZXJzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG4gIH1cblxuICAgIHNwcml0ZURvZXNOb3RFeGlzdCh2YWx1ZSwgYXJyYXkpIHtcbiAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGFycmF5W2ldLmtleSA9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH1cblxuXG4gICAgdXBkYXRlVXNlclNwcml0ZXMoX2RhdGEpe1xuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5fZW50aXR5LnNwcml0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9lbnRpdHkuc3ByaXRlc1tpXS5rZXkgIT0gdW5kZWZpbmVkICYmIF9kYXRhLmtleSA9PSB0aGlzLl9lbnRpdHkuc3ByaXRlc1tpXS5rZXkpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLl9lbnRpdHkuem9tYmllTW9kZSl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2VudGl0eS5zcHJpdGVzW2ldLnNwcml0ZS5wbGF5QW5pbWF0aW9uKCA4MCwgIDEwMCwgdHJ1ZSwgMTAwKTtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5fem9tYmllTW9kZUVuYWJsZWQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZW50aXR5LnNwcml0ZXNbaV0uc3ByaXRlLnBsYXlBbmltYXRpb24oTWF0aC5hYnMoIDIwIC0gcGFyc2VJbnQoX2RhdGEuZGF0YS5zcHJpdGVJRCkpLCAgcGFyc2VJbnQoX2RhdGEuZGF0YS5zcHJpdGVJRCksIHRydWUsIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fZW50aXR5LnNwcml0ZXNbaV0uc3ByaXRlLnBvc2l0aW9uID0gIF9kYXRhLmRhdGEucG9zaXRpb247XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbn1cbm1vZHVsZS5leHBvcnRzID0gc19tdWx0aXVzZXI7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9