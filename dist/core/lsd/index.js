"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),CES=require("ces"),utils=require("./utils/utils"),entities=require("./entities"),systems=require("./systems"),Request=require("../xhr/Request"),BABYLON=require("./lib/babylon"),lsd=function(){function lsd(){var e=arguments.length<=0||void 0===arguments[0]?document.body:arguments[0];_classCallCheck(this,lsd),this._defaults=utils.defaultArgs(),this._defaultsScene_two=utils.defaultArgs(),this._defaultsScene_two._appendEL=this._defaults._appendEL=e,this._data=null,this._currentScene,this._e_scene=new entities.e_scene(this._defaults),this._e_scene_two=new entities.e_scene(this._defaultsScene_two),this._e_cameravr=null,this._scenes=[],this._activeScene=0,this.camera=null,this.world=new CES.World,this.world.addEntity(this._e_scene.entity),this.world.addEntity(this._e_scene_two.entity),this.canvas,this._assets=[],Promise.all([document.querySelector("canvas")]).then(this.init.apply(this))}return _createClass(lsd,[{key:"init",value:function(){this.canvas=document.querySelector("canvas"),this.defaults=new Request("/assets/scene/scene.json",this.dataLoaded.bind(this))}},{key:"dataLoaded",value:function(){this._data=this.defaults.data,this.canvas.addEventListener("canvas_init",function(e){this.jsonAssets=this._data.assets,this._currentScene=this._defaults._scene=this._e_scene.scene.scene,this._scenes.push(this._currentScene),this._currentAltScene=this._e_scene_two.scene.scene,this._scenes.push(this._currentAltScene),utils.assetsLoad.apply(this)}.bind(this),!1)}},{key:"initListners",value:function(){window.addEventListener("resize",function(){this.canvas.heigth=window.innerHeight,this.canvas.width=window.innerWidth,this._currentScene.getEngine().resize()}.bind(this))}},{key:"loopJsonArr",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"entities":arguments[1];switch(t){case"entities":for(var s=0;s<this._data.entities.length;s++)e(s);break;case"systems":for(var s=0;s<this._data.systems.length;s++)e(s);break;default:for(var s=0;s<this._data.entities.length;s++)e(s)}}},{key:"setDefaultsAndMaterials",value:function setDefaultsAndMaterials(i){this._data.entities[i].defaults._scene=this._currentScene,this._data.entities[i].defaults._canvas=this.canvas;try{this._data.entities[i].defaults=utils.merge_objects(eval("entities."+this._data.entities[i].defaults.e_type+".defaults()"),this._data.entities[i].defaults)}catch(e){console.log(e+" - error loading entity no defaults set")}}},{key:"setVectorsAndOtherDefaults",value:function setVectorsAndOtherDefaults(i){void 0!=typeof this._data.entities[i].defaults._material&&(this._data.entities[i].defaults._material=utils.getMaterials(this._data.materials,this._data.entities[i].defaults._material)),void 0!=typeof this._data.entities[i].defaults._position&&(this._data.entities[i].defaults._position=utils.getVector(this._data.entities[i].defaults._position)),void 0!=typeof this._data.entities[i].defaults._rotation&&(this._data.entities[i].defaults._rotation=utils.getVector(this._data.entities[i].defaults._rotation,"rotation"));try{var ent=eval("new entities."+this._data.entities[i].defaults.e_type+"(this._data.entities[i].defaults)");this.world.addEntity(ent.entity)}catch(e){console.log(e+" - error loading entity")}}},{key:"setSystems",value:function setSystems(i){try{this._data.systems[i].defaults._canvas=this.canvas,this._data.systems[i].defaults._scene=this._currentScene,this.world.addSystem(eval("new systems."+this._data.systems[i].defaults.s_type+"(this._data.systems[i].defaults)"))}catch(e){console.log(e+" - error loading system")}}},{key:"assetLoadingFinished",value:function(){this.loopJsonArr(this.setDefaultsAndMaterials.bind(this)),this.loopJsonArr(this.setVectorsAndOtherDefaults.bind(this)),this.loopJsonArr(this.setSystems.bind(this),"systems"),this.initSceneAnimation(),this.initListners()}},{key:"swapScene",value:function(){var e=this._scenes[this._activeScene].activeCameras,t=this._scenes[this._activeScene];this._activeScene=0==this._activeScene?1:0,this._scenes[this._activeScene].activeCameras=e,this._scenes[this._activeScene].lights=t.lights;for(var s=0;s<this._scenes[this._activeScene].activeCameras.length;s++)this._scenes[this._activeScene].activeCameras[s]._scene=this._scenes[this._activeScene]}},{key:"sceneDemo",value:function(){var e=BABYLON.Mesh.CreateSphere("sphereTest",16,2,this._scenes[this._activeScene]);e.position.y=1,e.layerMask=268435455}},{key:"initSceneAnimation",value:function(){this.tick=.01,window.scene=this._scenes[this._activeScene],this.world._currentScene=this._currentScene,this.world._multiuserInit=!0,this._defaults._scene.collisionsEnabled=!0;for(var e=0;e<this._defaults._scene.cameras.length;e++)this._defaults._scene.cameras[e].checkCollisions=!0;this._scenes[0].renderLoop=function(){this._currentScene.activeCamera&&this.world._multiuserInit&&this._currentScene.render()}.bind(this),this._scenes[1].renderLoop=function(){this._currentAltScene.render()}.bind(this),this._scenes[this._activeScene].getEngine().runRenderLoop(function(){this.tick+=.01,window.tick=this.tick,this.world.update(this.tick),this._scenes[this._activeScene].renderLoop()}.bind(this))}},{key:"initSound",value:function(){console.log(window._sharedData),null!=window._sharedData.Sound&&(this._BabylonSound=new BABYLON.Sound(window._sharedData.Sound.sID,window._sharedData.trackURL))}}]),lsd}();module.exports=lsd;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvbHNkL2luZGV4LmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ0VTIiwicmVxdWlyZSIsInV0aWxzIiwiZW50aXRpZXMiLCJzeXN0ZW1zIiwiUmVxdWVzdCIsIkJBQllMT04iLCJsc2QiLCJfYXBwZW5kRWwiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJkb2N1bWVudCIsImJvZHkiLCJ0aGlzIiwiX2RlZmF1bHRzIiwiZGVmYXVsdEFyZ3MiLCJfZGVmYXVsdHNTY2VuZV90d28iLCJfYXBwZW5kRUwiLCJfZGF0YSIsIl9jdXJyZW50U2NlbmUiLCJfZV9zY2VuZSIsImVfc2NlbmUiLCJfZV9zY2VuZV90d28iLCJfZV9jYW1lcmF2ciIsIl9zY2VuZXMiLCJfYWN0aXZlU2NlbmUiLCJjYW1lcmEiLCJ3b3JsZCIsIldvcmxkIiwiYWRkRW50aXR5IiwiZW50aXR5IiwiY2FudmFzIiwiX2Fzc2V0cyIsIlByb21pc2UiLCJhbGwiLCJxdWVyeVNlbGVjdG9yIiwidGhlbiIsImluaXQiLCJhcHBseSIsInZhbHVlIiwiZGVmYXVsdHMiLCJkYXRhTG9hZGVkIiwiYmluZCIsImRhdGEiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImpzb25Bc3NldHMiLCJhc3NldHMiLCJfc2NlbmUiLCJzY2VuZSIsInB1c2giLCJfY3VycmVudEFsdFNjZW5lIiwiYXNzZXRzTG9hZCIsIndpbmRvdyIsImhlaWd0aCIsImlubmVySGVpZ2h0Iiwid2lkdGgiLCJpbm5lcldpZHRoIiwiZ2V0RW5naW5lIiwicmVzaXplIiwiX2Z1bmN0aW9uQ2FsbCIsIl90eXBlIiwic2V0RGVmYXVsdHNBbmRNYXRlcmlhbHMiLCJfY2FudmFzIiwibWVyZ2Vfb2JqZWN0cyIsImV2YWwiLCJlX3R5cGUiLCJjb25zb2xlIiwibG9nIiwic2V0VmVjdG9yc0FuZE90aGVyRGVmYXVsdHMiLCJfbWF0ZXJpYWwiLCJnZXRNYXRlcmlhbHMiLCJtYXRlcmlhbHMiLCJfcG9zaXRpb24iLCJnZXRWZWN0b3IiLCJfcm90YXRpb24iLCJlbnQiLCJzZXRTeXN0ZW1zIiwiYWRkU3lzdGVtIiwic190eXBlIiwibG9vcEpzb25BcnIiLCJpbml0U2NlbmVBbmltYXRpb24iLCJpbml0TGlzdG5lcnMiLCJjYW1Td2FwIiwiYWN0aXZlQ2FtZXJhcyIsInByZXZTY2VuZSIsImxpZ2h0cyIsInNwaGVyZSIsIk1lc2giLCJDcmVhdGVTcGhlcmUiLCJwb3NpdGlvbiIsInkiLCJsYXllck1hc2siLCJ0aWNrIiwiX211bHRpdXNlckluaXQiLCJjb2xsaXNpb25zRW5hYmxlZCIsImNhbWVyYXMiLCJjaGVja0NvbGxpc2lvbnMiLCJyZW5kZXJMb29wIiwiYWN0aXZlQ2FtZXJhIiwicmVuZGVyIiwicnVuUmVuZGVyTG9vcCIsInVwZGF0ZSIsIl9zaGFyZWREYXRhIiwiU291bmQiLCJfQmFieWxvblNvdW5kIiwic0lEIiwidHJhY2tVUkwiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQUZoSCxHQUFJQyxjQUFlLFdBQWUsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQVMsSUFBSyxHQUFJQyxHQUFJLEVBQUdBLEVBQUlELEVBQU1FLE9BQVFELElBQUssQ0FBRSxHQUFJRSxHQUFhSCxFQUFNQyxFQUFJRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQU9ELEVBQVdFLGNBQWUsRUFBVSxTQUFXRixLQUFZ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QixRQUFRQyxJQUFJZixPQUFPa0QsYUFDWSxNQUE1QmxELE9BQU9rRCxZQUFZQyxRQUNyQjNGLEtBQUs0RixjQUFnQixHQUFJbkcsU0FBUWtHLE1BQU1uRCxPQUFPa0QsWUFBWUMsTUFBTUUsSUFBS3JELE9BQU9rRCxZQUFZSSxlQTlLckZwRyxNQW9MTnFHLFFBQU9DLFFBQVV0RyIsImZpbGUiOiJjb3JlL2xzZC9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBDRVMgPSByZXF1aXJlKCdjZXMnKTtcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMnKTtcbnZhciBlbnRpdGllcyA9IHJlcXVpcmUoJy4vZW50aXRpZXMnKTtcbnZhciBzeXN0ZW1zID0gcmVxdWlyZSgnLi9zeXN0ZW1zJyk7XG52YXIgUmVxdWVzdCA9IHJlcXVpcmUoJy4uL3hoci9SZXF1ZXN0Jyk7XG52YXIgQkFCWUxPTiA9IHJlcXVpcmUoJy4vbGliL2JhYnlsb24nKTtcblxuLyoqXG4gKiAuLi5cbiAqIEBhdXRob3IgQnJlbmRvbiBTbWl0aFxuICogaHR0cDovL3NlYWNsb3VkOS5vcmdcbiAqIExpZ2h0V2VpZ2h0IDNEIFN5c3RlbSBEZXNpZ24gZW5naW5lXG4gKi9cbiBjbGFzcyBsc2R7XG4gXHRjb25zdHJ1Y3RvcihfYXBwZW5kRWwgPSBkb2N1bWVudC5ib2R5KXtcbiBcdFx0dGhpcy5fZGVmYXVsdHMgPSB1dGlscy5kZWZhdWx0QXJncygpO1xuICAgIHRoaXMuX2RlZmF1bHRzU2NlbmVfdHdvID0gdXRpbHMuZGVmYXVsdEFyZ3MoKTtcbiBcdFx0dGhpcy5fZGVmYXVsdHNTY2VuZV90d28uX2FwcGVuZEVMID0gdGhpcy5fZGVmYXVsdHMuX2FwcGVuZEVMID0gX2FwcGVuZEVsO1xuIFx0XHR0aGlzLl9kYXRhID0gbnVsbDtcbiBcdFx0dGhpcy5fY3VycmVudFNjZW5lO1xuIFx0XHR0aGlzLl9lX3NjZW5lID0gbmV3IGVudGl0aWVzLmVfc2NlbmUodGhpcy5fZGVmYXVsdHMpO1xuICAgIHRoaXMuX2Vfc2NlbmVfdHdvID0gbmV3IGVudGl0aWVzLmVfc2NlbmUodGhpcy5fZGVmYXVsdHNTY2VuZV90d28pO1xuIFx0XHR0aGlzLl9lX2NhbWVyYXZyID0gbnVsbDtcbiAgICB0aGlzLl9zY2VuZXMgPSBbXTtcbiAgICB0aGlzLl9hY3RpdmVTY2VuZSA9IDA7XG4gXHRcdHRoaXMuY2FtZXJhID0gbnVsbDtcbiBcdFx0dGhpcy53b3JsZCA9IG5ldyBDRVMuV29ybGQoKTtcbiBcdFx0dGhpcy53b3JsZC5hZGRFbnRpdHkodGhpcy5fZV9zY2VuZS5lbnRpdHkpO1xuICAgIHRoaXMud29ybGQuYWRkRW50aXR5KHRoaXMuX2Vfc2NlbmVfdHdvLmVudGl0eSk7XG4gXHRcdHRoaXMuY2FudmFzO1xuIFx0XHR0aGlzLl9hc3NldHMgPSBbXTtcbiBcdFx0UHJvbWlzZS5hbGwoW2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpXSkudGhlbih0aGlzLmluaXQuYXBwbHkodGhpcykpO1xuIFx0fVxuXG4gXHRpbml0KCl7XG4gXHRcdHRoaXMuY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY2FudmFzJyk7XG4gXHRcdHRoaXMuZGVmYXVsdHMgPSBuZXcgUmVxdWVzdChcIi9hc3NldHMvc2NlbmUvc2NlbmUuanNvblwiLCB0aGlzLmRhdGFMb2FkZWQuYmluZCh0aGlzKSk7XG4gXHR9XG5cbiBcdGRhdGFMb2FkZWQoKXtcbiBcdFx0dGhpcy5fZGF0YSAgPSB0aGlzLmRlZmF1bHRzLmRhdGE7XG4gXHRcdHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NhbnZhc19pbml0JywgZnVuY3Rpb24gKGUpIHtcbiBcdFx0XHR0aGlzLmpzb25Bc3NldHMgPSB0aGlzLl9kYXRhLmFzc2V0cztcbiBcdFx0XHR0aGlzLl9jdXJyZW50U2NlbmUgPSB0aGlzLl9kZWZhdWx0cy5fc2NlbmUgPSB0aGlzLl9lX3NjZW5lLnNjZW5lLnNjZW5lO1xuICAgICAgdGhpcy5fc2NlbmVzLnB1c2godGhpcy5fY3VycmVudFNjZW5lKTtcbiAgICAgIHRoaXMuX2N1cnJlbnRBbHRTY2VuZSAgPSB0aGlzLl9lX3NjZW5lX3R3by5zY2VuZS5zY2VuZTtcbiAgICAgIHRoaXMuX3NjZW5lcy5wdXNoKHRoaXMuX2N1cnJlbnRBbHRTY2VuZSk7XG4gXHRcdFx0dXRpbHMuYXNzZXRzTG9hZC5hcHBseSh0aGlzKTtcbiBcdFx0fS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiBcdH1cblxuIFx0aW5pdExpc3RuZXJzKCl7XG4gXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiBcdFx0XHR0aGlzLmNhbnZhcy5oZWlndGggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gXHRcdFx0dGhpcy5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcdFxuIFx0XHRcdHRoaXMuX2N1cnJlbnRTY2VuZS5nZXRFbmdpbmUoKS5yZXNpemUoKTtcbiBcdFx0fS5iaW5kKHRoaXMpKTtcbiBcdH1cblxuIFx0bG9vcEpzb25BcnIoX2Z1bmN0aW9uQ2FsbCwgX3R5cGUgPSAnZW50aXRpZXMnKXtcbiBcdFx0c3dpdGNoKF90eXBlKSB7XG5cdFx0ICAgIGNhc2UgJ2VudGl0aWVzJzpcblx0XHQgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLl9kYXRhLmVudGl0aWVzLmxlbmd0aDsgaSsrKXtcblx0XHQgXHRcdFx0X2Z1bmN0aW9uQ2FsbChpKTtcblx0XHQgXHRcdH1cblx0XHQgICAgICAgIGJyZWFrO1xuXHRcdCAgICBjYXNlICdzeXN0ZW1zJzpcblx0XHQgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5fZGF0YS5zeXN0ZW1zLmxlbmd0aDsgaSsrKXtcblx0XHQgXHRcdFx0X2Z1bmN0aW9uQ2FsbChpKTtcblx0XHQgXHRcdH1cblx0XHQgICAgICAgIGJyZWFrO1x0ICAgICAgICBcdFx0ICAgICAgICBcblx0XHQgICAgZGVmYXVsdDpcblx0XHQgICAgIFx0Zm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX2RhdGEuZW50aXRpZXMubGVuZ3RoOyBpKyspe1xuXHRcdCBcdFx0XHRfZnVuY3Rpb25DYWxsKGkpO1xuXHRcdCBcdFx0fVxuXHRcdFxuXHRcdH1cbiBcdFx0XG4gXHR9XG5cbiBcdHNldERlZmF1bHRzQW5kTWF0ZXJpYWxzKGkpe1xuIFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9zY2VuZSA9IHRoaXMuX2N1cnJlbnRTY2VuZTtcbiBcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fY2FudmFzID0gdGhpcy5jYW52YXM7XG4gXHRcdHRyeXtcbiBcdFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzID0gdXRpbHMubWVyZ2Vfb2JqZWN0cyhldmFsKCdlbnRpdGllcy4nICsgdGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5lX3R5cGUrXCIuZGVmYXVsdHMoKVwiKSwgdGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cyk7XG4gXHRcdH1jYXRjaChlKXtcbiBcdFx0XHRjb25zb2xlLmxvZyhlICsgJyAtIGVycm9yIGxvYWRpbmcgZW50aXR5IG5vIGRlZmF1bHRzIHNldCcpO1xuIFx0XHR9XG4gXHR9XG5cbiBcdHNldFZlY3RvcnNBbmRPdGhlckRlZmF1bHRzKGkpe1xuIFx0XHRpZih0eXBlb2YgdGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fbWF0ZXJpYWwgIT0gdW5kZWZpbmVkKXtcbiBcdFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9tYXRlcmlhbCA9IHV0aWxzLmdldE1hdGVyaWFscyh0aGlzLl9kYXRhLm1hdGVyaWFscywgdGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fbWF0ZXJpYWwpO1xuIFx0XHR9XG4gXHRcdGlmKHR5cGVvZiB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9wb3NpdGlvbiAhPSB1bmRlZmluZWQpe1xuIFx0XHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3Bvc2l0aW9uID0gdXRpbHMuZ2V0VmVjdG9yKHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3Bvc2l0aW9uKTtcbiBcdFx0fVxuIFx0XHRpZih0eXBlb2YgdGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcm90YXRpb24gIT0gdW5kZWZpbmVkKXtcbiBcdFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9yb3RhdGlvbiA9IHV0aWxzLmdldFZlY3Rvcih0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9yb3RhdGlvbiwgJ3JvdGF0aW9uJyk7XG4gXHRcdH1cbiBcdFx0dHJ5e1xuIFx0XHRcdHZhciBlbnQgPSBldmFsKFwibmV3IGVudGl0aWVzLlwiICsgdGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5lX3R5cGUgKyBcIih0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzKVwiKTtcbiBcdFx0XHR0aGlzLndvcmxkLmFkZEVudGl0eShlbnQuZW50aXR5KTtcbiBcdFx0fWNhdGNoKGUpe1xuIFx0XHRcdGNvbnNvbGUubG9nKGUgKyAnIC0gZXJyb3IgbG9hZGluZyBlbnRpdHknKTtcbiBcdFx0fVxuIFx0fVxuXG4gXHRzZXRTeXN0ZW1zKGkpe1xuIFx0XHR0cnl7XG4gXHRcdFx0dGhpcy5fZGF0YS5zeXN0ZW1zW2ldLmRlZmF1bHRzLl9jYW52YXMgPSB0aGlzLmNhbnZhcztcbiBcdFx0XHR0aGlzLl9kYXRhLnN5c3RlbXNbaV0uZGVmYXVsdHMuX3NjZW5lID0gdGhpcy5fY3VycmVudFNjZW5lO1xuIFx0XHRcdHRoaXMud29ybGQuYWRkU3lzdGVtKCBldmFsKFwibmV3IHN5c3RlbXMuXCIgKyB0aGlzLl9kYXRhLnN5c3RlbXNbaV0uZGVmYXVsdHMuc190eXBlICsgXCIodGhpcy5fZGF0YS5zeXN0ZW1zW2ldLmRlZmF1bHRzKVwiKSk7XG4gXHRcdH1jYXRjaChlKXtcbiBcdFx0XHRjb25zb2xlLmxvZyhlICsgJyAtIGVycm9yIGxvYWRpbmcgc3lzdGVtJyk7XG4gXHRcdH1cbiBcdH1cblxuXG4gXHRhc3NldExvYWRpbmdGaW5pc2hlZCgpe1xuIFx0XHR0aGlzLmxvb3BKc29uQXJyKHRoaXMuc2V0RGVmYXVsdHNBbmRNYXRlcmlhbHMuYmluZCh0aGlzKSk7XG4gXHRcdHRoaXMubG9vcEpzb25BcnIodGhpcy5zZXRWZWN0b3JzQW5kT3RoZXJEZWZhdWx0cy5iaW5kKHRoaXMpKTtcbiBcdFx0dGhpcy5sb29wSnNvbkFycih0aGlzLnNldFN5c3RlbXMuYmluZCh0aGlzKSwgJ3N5c3RlbXMnKTtcbiBcdFx0dGhpcy5pbml0U2NlbmVBbmltYXRpb24oKTtcbiBcdFx0dGhpcy5pbml0TGlzdG5lcnMoKTtcbiBcdH1cblxuICBzd2FwU2NlbmUoKXtcbiAgICB2YXIgY2FtU3dhcCA9IHRoaXMuX3NjZW5lc1t0aGlzLl9hY3RpdmVTY2VuZV0uYWN0aXZlQ2FtZXJhcztcbiAgICB2YXIgcHJldlNjZW5lID0gdGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXTtcbiAgICB0aGlzLl9hY3RpdmVTY2VuZSAgPSB0aGlzLl9hY3RpdmVTY2VuZSA9PSAwID8gMTowO1xuICAgIHRoaXMuX3NjZW5lc1t0aGlzLl9hY3RpdmVTY2VuZV0uYWN0aXZlQ2FtZXJhcyA9IGNhbVN3YXA7XG4gICAgdGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXS5saWdodHMgPSBwcmV2U2NlbmUubGlnaHRzO1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLl9zY2VuZXNbdGhpcy5fYWN0aXZlU2NlbmVdLmFjdGl2ZUNhbWVyYXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgIHRoaXMuX3NjZW5lc1t0aGlzLl9hY3RpdmVTY2VuZV0uYWN0aXZlQ2FtZXJhc1tpXS5fc2NlbmUgPSB0aGlzLl9zY2VuZXNbdGhpcy5fYWN0aXZlU2NlbmVdO1xuICAgIH1cblxuICB9XG5cblxuICBzY2VuZURlbW8oKXtcbiAgICB2YXIgc3BoZXJlID0gQkFCWUxPTi5NZXNoLkNyZWF0ZVNwaGVyZShcInNwaGVyZVRlc3RcIiwgMTYsIDIsIHRoaXMuX3NjZW5lc1t0aGlzLl9hY3RpdmVTY2VuZV0pO1xuICAgIHNwaGVyZS5wb3NpdGlvbi55ID0gMTtcbiAgICBzcGhlcmUubGF5ZXJNYXNrID0gMHgwRkZGRkZGRjtcbiAgfVxuXG4gXHRpbml0U2NlbmVBbmltYXRpb24oKXtcbiBcdFx0dGhpcy50aWNrID0gMC4wMTtcbiBcdFx0Ly8gdG9kbyByZW1vdmUgdGhpcyBvbmx5IGZvciBkZWJ1Z2dpbmcgcHVycG9zZXNcbiBcdFx0d2luZG93LnNjZW5lID0gdGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXTtcbiBcdFx0dGhpcy53b3JsZC5fY3VycmVudFNjZW5lID0gdGhpcy5fY3VycmVudFNjZW5lO1xuICAgIC8vIHRvZG8gbWVoIGRpc2FibGUgbXVsdGl1c2VyIFxuIFx0XHR0aGlzLndvcmxkLl9tdWx0aXVzZXJJbml0ID0gdHJ1ZTtcbiAgICB0aGlzLl9kZWZhdWx0cy5fc2NlbmUuY29sbGlzaW9uc0VuYWJsZWQgPSB0cnVlO1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLl9kZWZhdWx0cy5fc2NlbmUuY2FtZXJhcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgdGhpcy5fZGVmYXVsdHMuX3NjZW5lLmNhbWVyYXNbaV0uY2hlY2tDb2xsaXNpb25zID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5fc2NlbmVzWzBdLnJlbmRlckxvb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZih0aGlzLl9jdXJyZW50U2NlbmUuYWN0aXZlQ2FtZXJhICYmIHRoaXMud29ybGQuX211bHRpdXNlckluaXQpe1xuICAgICAgICB0aGlzLl9jdXJyZW50U2NlbmUucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgXG4gICAgdGhpcy5fc2NlbmVzWzFdLnJlbmRlckxvb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRBbHRTY2VuZS5yZW5kZXIoKTtcbiAgICB9LmJpbmQodGhpcyk7XG4gICAgXG5cbiBcdFx0dGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXS5nZXRFbmdpbmUoKS5ydW5SZW5kZXJMb29wKGZ1bmN0aW9uICgpIHtcbiBcdFx0XHR0aGlzLnRpY2sgKz0gLjAxO1xuIFx0XHRcdHdpbmRvdy50aWNrID0gdGhpcy50aWNrO1xuIFx0XHRcdHRoaXMud29ybGQudXBkYXRlKHRoaXMudGljayk7XG4gXHRcdFx0dGhpcy5fc2NlbmVzW3RoaXMuX2FjdGl2ZVNjZW5lXS5yZW5kZXJMb29wKCk7XG4gXHRcdH0uYmluZCh0aGlzKSk7XG5cblxuIFx0fVxuXG5cblxuIFx0Ly9iZWxvdyB0aGlzIGlzIGNvZGUgdGhhdCBzaG91bGQgZXZlbnR1YWxseSBiZSBlbGltaW5pYXRlZCBvbmx5IGZvciBoYWNrYXRob24gcHVycG9zZXNcblxuIFx0aW5pdFNvdW5kKCl7XG4gXHRcdGNvbnNvbGUubG9nKHdpbmRvdy5fc2hhcmVkRGF0YSk7XG4gXHRcdGlmKHdpbmRvdy5fc2hhcmVkRGF0YS5Tb3VuZCAhPSBudWxsKXtcbiBcdFx0XHR0aGlzLl9CYWJ5bG9uU291bmQgPSBuZXcgQkFCWUxPTi5Tb3VuZCh3aW5kb3cuX3NoYXJlZERhdGEuU291bmQuc0lELCB3aW5kb3cuX3NoYXJlZERhdGEudHJhY2tVUkwpO1xuIFx0XHR9XG4gXHR9XG5cblxuIH1cbiBtb2R1bGUuZXhwb3J0cyA9IGxzZDsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=