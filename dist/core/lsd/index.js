"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),CES=require("ces"),utils=require("./utils/utils"),entities=require("./entities"),systems=require("./systems"),Request=require("../xhr/Request"),lsd=function(){function lsd(){_classCallCheck(this,lsd),this._defaults=utils.defaultArgs(),this._data=null,this._crurrentScene,this._e_scene=new entities.e_scene,this._e_cameravr=null,this.camera=null,this.world=new CES.World,this.world.addEntity(this._e_scene.entity),this.canvas,this._assets=[],Promise.all([document.querySelector("canvas")]).then(this.init.apply(this))}return _createClass(lsd,[{key:"init",value:function(){this.canvas=document.querySelector("canvas"),this.defaults=new Request("/assets/scene/scene.json",this.dataLoaded.bind(this))}},{key:"dataLoaded",value:function(){console.log(this.defaults.data),this._data=this.defaults.data,this.canvas.addEventListener("canvas_init",function(t){this.jsonAssets=this._data.assets,this._crurrentScene=this._defaults._scene=this._e_scene.scene.scene,utils.assetsLoad.apply(this)}.bind(this),!1)}},{key:"initListners",value:function(){window.addEventListener("resize",function(){this.canvas.heigth=window.innerHeight,this.canvas.width=window.innerWidth,this._crurrentScene.getEngine().resize()}.bind(this))}},{key:"loopJsonArr",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"entities":arguments[1];switch(e){case"entities":for(var s=0;s<this._data.entities.length;s++)t(s);break;case"systems":for(var s=0;s<this._data.systems.length;s++)t(s);break;default:for(var s=0;s<this._data.entities.length;s++)t(s)}}},{key:"setDefaultsAndMaterials",value:function setDefaultsAndMaterials(i){this._data.entities[i].defaults._scene=this._crurrentScene,this._data.entities[i].defaults._canvas=this.canvas;try{this._data.entities[i].defaults=utils.merge_objects(eval("entities."+this._data.entities[i].defaults.e_type+".defaults()"),this._data.entities[i].defaults)}catch(e){console.log(e+" - error loading entity no defaults set")}}},{key:"setVectorsAndOtherDefaults",value:function setVectorsAndOtherDefaults(i){void 0!=typeof this._data.entities[i].defaults._material&&(this._data.entities[i].defaults._material=utils.getMaterials(this._data.materials,this._data.entities[i].defaults._material)),void 0!=typeof this._data.entities[i].defaults._position&&(this._data.entities[i].defaults._position=utils.getVector(this._data.entities[i].defaults._position)),void 0!=typeof this._data.entities[i].defaults._rotation&&(this._data.entities[i].defaults._rotation=utils.getVector(this._data.entities[i].defaults._rotation,"rotation"));try{var ent=eval("new entities."+this._data.entities[i].defaults.e_type+"(this._data.entities[i].defaults)");this.world.addEntity(ent.entity)}catch(e){console.log(e+" - error loading entity")}}},{key:"setSystems",value:function setSystems(i){try{this._data.systems[i].defaults._canvas=this.canvas,this._data.systems[i].defaults._scene=this._crurrentScene,this.world.addSystem(eval("new systems."+this._data.systems[i].defaults.s_type+"(this._data.systems[i].defaults)"))}catch(e){console.log(e+" - error loading system")}}},{key:"assetLoadingFinished",value:function(){this.loopJsonArr(this.setDefaultsAndMaterials.bind(this)),this.loopJsonArr(this.setVectorsAndOtherDefaults.bind(this)),this.loopJsonArr(this.setSystems.bind(this),"systems"),this.initSceneAnimation(),this.initListners()}},{key:"initSceneAnimation",value:function(){this.tick=.01,window.scene=this._crurrentScene,this.world._crurrentScene=this._crurrentScene,this.world._multiuserInit=!1,this._crurrentScene.getEngine().runRenderLoop(function(){this.tick+=.01,window.tick=this.tick,this.world.update(this.tick),this._crurrentScene.activeCamera&&this.world._multiuserInit&&this._crurrentScene.render()}.bind(this))}}]),lsd}();module.exports=lsd;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvbHNkL2luZGV4LmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ0VTIiwicmVxdWlyZSIsInV0aWxzIiwiZW50aXRpZXMiLCJzeXN0ZW1zIiwiUmVxdWVzdCIsImxzZCIsInRoaXMiLCJfZGVmYXVsdHMiLCJkZWZhdWx0QXJncyIsIl9kYXRhIiwiX2NydXJyZW50U2NlbmUiLCJfZV9zY2VuZSIsImVfc2NlbmUiLCJfZV9jYW1lcmF2ciIsImNhbWVyYSIsIndvcmxkIiwiV29ybGQiLCJhZGRFbnRpdHkiLCJlbnRpdHkiLCJjYW52YXMiLCJfYXNzZXRzIiwiUHJvbWlzZSIsImFsbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRoZW4iLCJpbml0IiwiYXBwbHkiLCJ2YWx1ZSIsImRlZmF1bHRzIiwiZGF0YUxvYWRlZCIsImJpbmQiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwianNvbkFzc2V0cyIsImFzc2V0cyIsIl9zY2VuZSIsInNjZW5lIiwiYXNzZXRzTG9hZCIsIndpbmRvdyIsImhlaWd0aCIsImlubmVySGVpZ2h0Iiwid2lkdGgiLCJpbm5lcldpZHRoIiwiZ2V0RW5naW5lIiwicmVzaXplIiwiX2Z1bmN0aW9uQ2FsbCIsIl90eXBlIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwic2V0RGVmYXVsdHNBbmRNYXRlcmlhbHMiLCJfY2FudmFzIiwibWVyZ2Vfb2JqZWN0cyIsImV2YWwiLCJlX3R5cGUiLCJzZXRWZWN0b3JzQW5kT3RoZXJEZWZhdWx0cyIsIl9tYXRlcmlhbCIsImdldE1hdGVyaWFscyIsIm1hdGVyaWFscyIsIl9wb3NpdGlvbiIsImdldFZlY3RvciIsIl9yb3RhdGlvbiIsImVudCIsInNldFN5c3RlbXMiLCJhZGRTeXN0ZW0iLCJzX3R5cGUiLCJsb29wSnNvbkFyciIsImluaXRTY2VuZUFuaW1hdGlvbiIsImluaXRMaXN0bmVycyIsInRpY2siLCJfbXVsdGl1c2VySW5pdCIsInJ1blJlbmRlckxvb3AiLCJ1cGRhdGUiLCJhY3RpdmVDYW1lcmEiLCJyZW5kZXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQUZoSCxHQUFJQyxjQUFlLFdBQWUsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQVMsSUFBSyxHQUFJQyxHQUFJLEVBQUdBLEVBQUlELEVBQU1FLE9BQVFELElBQUssQ0FBRSxHQUFJRSxHQUFhSCxFQUFNQyxFQUFJRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQU9ELEVBQVdFLGNBQWUsRUFBVSxTQUFXRixLQUFZQSxFQUFXRyxVQUFXLEdBQU1DLE9BQU9DLGVBQWVULEVBQVFJLEVBQVdNLElBQUtOLElBQWlCLE1BQU8sVUFBVVIsRUFBYWUsRUFBWUMsR0FBaUosTUFBOUhELElBQVlaLEVBQWlCSCxFQUFZaUIsVUFBV0YsR0FBaUJDLEdBQWFiLEVBQWlCSCxFQUFhZ0IsR0FBcUJoQixNQUY3aEJrQixJQUFNQyxRQUFRLE9BQ2RDLE1BQVFELFFBQVEsaUJBQ2hCRSxTQUFXRixRQUFRLGNBQ25CRyxRQUFVSCxRQUFRLGFBQ2xCSSxRQUFVSixRQUFRLGtCQVNmSyxJQUFHLFdBQ0csUUFETkEsT0FRSDFCLGdCQUFnQjJCLEtBUmJELEtBRUpDLEtBQUtDLFVBQVlOLE1BQU1PLGNBQ3ZCRixLQUFLRyxNQUFRLEtBQ2JILEtBQUtJLGVBQ0xK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S0ksZUFBZXFDLFlBQVkyQixjQUFjLFdBQzdDcEUsS0FBS2tFLE1BQVEsSUFDYjlCLE9BQU84QixLQUFPbEUsS0FBS2tFLEtBQ25CbEUsS0FBS1MsTUFBTTRELE9BQU9yRSxLQUFLa0UsTUFDcEJsRSxLQUFLSSxlQUFla0UsY0FBZ0J0RSxLQUFLUyxNQUFNMEQsZ0JBQ2pEbkUsS0FBS0ksZUFBZW1FLFVBRXBCOUMsS0FBS3pCLFdBeEhIRCxNQTJITnlFLFFBQU9DLFFBQVUxRSIsImZpbGUiOiJjb3JlL2xzZC9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBDRVMgPSByZXF1aXJlKCdjZXMnKTtcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMvdXRpbHMnKTtcbnZhciBlbnRpdGllcyA9IHJlcXVpcmUoJy4vZW50aXRpZXMnKTtcbnZhciBzeXN0ZW1zID0gcmVxdWlyZSgnLi9zeXN0ZW1zJyk7XG52YXIgUmVxdWVzdCA9IHJlcXVpcmUoJy4uL3hoci9SZXF1ZXN0Jyk7XG5cblxuLyoqXG4gKiAuLi5cbiAqIEBhdXRob3IgQnJlbmRvbiBTbWl0aFxuICogaHR0cDovL3NlYWNsb3VkOS5vcmdcbiAqIExpZ2h0V2VpZ2h0IDNEIFN5c3RlbSBEZXNpZ24gZW5naW5lXG4gKi9cbiBjbGFzcyBsc2R7XG4gXHRjb25zdHJ1Y3Rvcigpe1xuIFx0XHR0aGlzLl9kZWZhdWx0cyA9IHV0aWxzLmRlZmF1bHRBcmdzKCk7XG4gXHRcdHRoaXMuX2RhdGEgPSBudWxsO1xuIFx0XHR0aGlzLl9jcnVycmVudFNjZW5lO1xuIFx0XHR0aGlzLl9lX3NjZW5lID0gbmV3IGVudGl0aWVzLmVfc2NlbmUoKTtcbiBcdFx0dGhpcy5fZV9jYW1lcmF2ciA9IG51bGw7XG4gXHRcdHRoaXMuY2FtZXJhID0gbnVsbDtcbiBcdFx0dGhpcy53b3JsZCA9IG5ldyBDRVMuV29ybGQoKTtcbiBcdFx0dGhpcy53b3JsZC5hZGRFbnRpdHkodGhpcy5fZV9zY2VuZS5lbnRpdHkpO1xuIFx0XHR0aGlzLmNhbnZhcztcbiBcdFx0dGhpcy5fYXNzZXRzID0gW107XG4gXHRcdFByb21pc2UuYWxsKFtkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKV0pLnRoZW4odGhpcy5pbml0LmFwcGx5KHRoaXMpKTtcbiBcdH1cblxuIFx0aW5pdCgpe1xuIFx0XHR0aGlzLmNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpO1xuIFx0XHR0aGlzLmRlZmF1bHRzID0gbmV3IFJlcXVlc3QoXCIvYXNzZXRzL3NjZW5lL3NjZW5lLmpzb25cIiwgdGhpcy5kYXRhTG9hZGVkLmJpbmQodGhpcykpO1xuIFx0fVxuXG4gXHRkYXRhTG9hZGVkKCl7XG4gXHRcdGNvbnNvbGUubG9nKHRoaXMuZGVmYXVsdHMuZGF0YSk7XG4gXHRcdHRoaXMuX2RhdGEgID0gdGhpcy5kZWZhdWx0cy5kYXRhO1xuIFx0XHR0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjYW52YXNfaW5pdCcsIGZ1bmN0aW9uIChlKSB7XG4gXHRcdFx0dGhpcy5qc29uQXNzZXRzID0gdGhpcy5fZGF0YS5hc3NldHM7XG4gXHRcdFx0dGhpcy5fY3J1cnJlbnRTY2VuZSA9IHRoaXMuX2RlZmF1bHRzLl9zY2VuZSA9IHRoaXMuX2Vfc2NlbmUuc2NlbmUuc2NlbmU7XG4gXHRcdFx0dXRpbHMuYXNzZXRzTG9hZC5hcHBseSh0aGlzKTtcbiBcdFx0fS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiBcdH1cblxuIFx0aW5pdExpc3RuZXJzKCl7XG4gXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiBcdFx0XHR0aGlzLmNhbnZhcy5oZWlndGggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gXHRcdFx0dGhpcy5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcdFxuIFx0XHRcdHRoaXMuX2NydXJyZW50U2NlbmUuZ2V0RW5naW5lKCkucmVzaXplKCk7XG4gXHRcdH0uYmluZCh0aGlzKSk7XG4gXHR9XG5cbiBcdGxvb3BKc29uQXJyKF9mdW5jdGlvbkNhbGwsIF90eXBlID0gJ2VudGl0aWVzJyl7XG4gXHRcdHN3aXRjaChfdHlwZSkge1xuXHRcdCAgICBjYXNlICdlbnRpdGllcyc6XG5cdFx0ICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5fZGF0YS5lbnRpdGllcy5sZW5ndGg7IGkrKyl7XG5cdFx0IFx0XHRcdF9mdW5jdGlvbkNhbGwoaSk7XG5cdFx0IFx0XHR9XG5cdFx0ICAgICAgICBicmVhaztcblx0XHQgICAgY2FzZSAnc3lzdGVtcyc6XG5cdFx0ICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX2RhdGEuc3lzdGVtcy5sZW5ndGg7IGkrKyl7XG5cdFx0IFx0XHRcdF9mdW5jdGlvbkNhbGwoaSk7XG5cdFx0IFx0XHR9XG5cdFx0ICAgICAgICBicmVhaztcdCAgICAgICAgXHRcdCAgICAgICAgXG5cdFx0ICAgIGRlZmF1bHQ6XG5cdFx0ICAgICBcdGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLl9kYXRhLmVudGl0aWVzLmxlbmd0aDsgaSsrKXtcblx0XHQgXHRcdFx0X2Z1bmN0aW9uQ2FsbChpKTtcblx0XHQgXHRcdH1cblx0XHRcblx0XHR9XG4gXHRcdFxuIFx0fVxuXG4gXHRzZXREZWZhdWx0c0FuZE1hdGVyaWFscyhpKXtcbiBcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fc2NlbmUgPSB0aGlzLl9jcnVycmVudFNjZW5lO1xuIFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9jYW52YXMgPSB0aGlzLmNhbnZhcztcbiBcdFx0dHJ5e1xuIFx0XHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMgPSB1dGlscy5tZXJnZV9vYmplY3RzKGV2YWwoJ2VudGl0aWVzLicgKyB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLmVfdHlwZStcIi5kZWZhdWx0cygpXCIpLCB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzKTtcbiBcdFx0fWNhdGNoKGUpe1xuIFx0XHRcdGNvbnNvbGUubG9nKGUgKyAnIC0gZXJyb3IgbG9hZGluZyBlbnRpdHkgbm8gZGVmYXVsdHMgc2V0Jyk7XG4gXHRcdH1cbiBcdH1cblxuIFx0c2V0VmVjdG9yc0FuZE90aGVyRGVmYXVsdHMoaSl7XG4gXHRcdGlmKHR5cGVvZiB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9tYXRlcmlhbCAhPSB1bmRlZmluZWQpe1xuIFx0XHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX21hdGVyaWFsID0gdXRpbHMuZ2V0TWF0ZXJpYWxzKHRoaXMuX2RhdGEubWF0ZXJpYWxzLCB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9tYXRlcmlhbCk7XG4gXHRcdH1cbiBcdFx0aWYodHlwZW9mIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3Bvc2l0aW9uICE9IHVuZGVmaW5lZCl7XG4gXHRcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcG9zaXRpb24gPSB1dGlscy5nZXRWZWN0b3IodGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcG9zaXRpb24pO1xuIFx0XHR9XG4gXHRcdGlmKHR5cGVvZiB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9yb3RhdGlvbiAhPSB1bmRlZmluZWQpe1xuIFx0XHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3JvdGF0aW9uID0gdXRpbHMuZ2V0VmVjdG9yKHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3JvdGF0aW9uLCAncm90YXRpb24nKTtcbiBcdFx0fVxuIFx0XHR0cnl7XG4gXHRcdFx0dmFyIGVudCA9IGV2YWwoXCJuZXcgZW50aXRpZXMuXCIgKyB0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLmVfdHlwZSArIFwiKHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMpXCIpO1xuIFx0XHRcdHRoaXMud29ybGQuYWRkRW50aXR5KGVudC5lbnRpdHkpO1xuIFx0XHR9Y2F0Y2goZSl7XG4gXHRcdFx0Y29uc29sZS5sb2coZSArICcgLSBlcnJvciBsb2FkaW5nIGVudGl0eScpO1xuIFx0XHR9XG4gXHR9XG5cbiBcdHNldFN5c3RlbXMoaSl7XG4gXHRcdHRyeXtcbiBcdFx0XHR0aGlzLl9kYXRhLnN5c3RlbXNbaV0uZGVmYXVsdHMuX2NhbnZhcyA9IHRoaXMuY2FudmFzO1xuIFx0XHRcdHRoaXMuX2RhdGEuc3lzdGVtc1tpXS5kZWZhdWx0cy5fc2NlbmUgPSB0aGlzLl9jcnVycmVudFNjZW5lO1xuIFx0XHRcdHRoaXMud29ybGQuYWRkU3lzdGVtKCBldmFsKFwibmV3IHN5c3RlbXMuXCIgKyB0aGlzLl9kYXRhLnN5c3RlbXNbaV0uZGVmYXVsdHMuc190eXBlICsgXCIodGhpcy5fZGF0YS5zeXN0ZW1zW2ldLmRlZmF1bHRzKVwiKSk7XG4gXHRcdH1jYXRjaChlKXtcbiBcdFx0XHRjb25zb2xlLmxvZyhlICsgJyAtIGVycm9yIGxvYWRpbmcgc3lzdGVtJyk7XG4gXHRcdH1cbiBcdH1cblxuXG4gXHRhc3NldExvYWRpbmdGaW5pc2hlZCgpe1xuIFx0XHR0aGlzLmxvb3BKc29uQXJyKHRoaXMuc2V0RGVmYXVsdHNBbmRNYXRlcmlhbHMuYmluZCh0aGlzKSk7XG4gXHRcdHRoaXMubG9vcEpzb25BcnIodGhpcy5zZXRWZWN0b3JzQW5kT3RoZXJEZWZhdWx0cy5iaW5kKHRoaXMpKTtcbiBcdFx0dGhpcy5sb29wSnNvbkFycih0aGlzLnNldFN5c3RlbXMuYmluZCh0aGlzKSwgJ3N5c3RlbXMnKTtcbiBcdFx0dGhpcy5pbml0U2NlbmVBbmltYXRpb24oKTtcbiBcdFx0dGhpcy5pbml0TGlzdG5lcnMoKTtcbiBcdH1cblxuIFx0aW5pdFNjZW5lQW5pbWF0aW9uKCl7XG4gXHRcdHRoaXMudGljayA9IDAuMDE7XG4gXHRcdC8vIHRvZG8gcmVtb3ZlIHRoaXMgb25seSBmb3IgZGVidWdnaW5nIHB1cnBvc2VzXG4gXHRcdHdpbmRvdy5zY2VuZSA9IHRoaXMuX2NydXJyZW50U2NlbmU7XG4gXHRcdHRoaXMud29ybGQuX2NydXJyZW50U2NlbmUgPSB0aGlzLl9jcnVycmVudFNjZW5lO1xuIFx0XHR0aGlzLndvcmxkLl9tdWx0aXVzZXJJbml0ID0gZmFsc2U7XG4gXHRcdHRoaXMuX2NydXJyZW50U2NlbmUuZ2V0RW5naW5lKCkucnVuUmVuZGVyTG9vcChmdW5jdGlvbiAoKSB7XG4gXHRcdFx0dGhpcy50aWNrICs9IC4wMTtcbiBcdFx0XHR3aW5kb3cudGljayA9IHRoaXMudGljaztcbiBcdFx0XHR0aGlzLndvcmxkLnVwZGF0ZSh0aGlzLnRpY2spO1xuIFx0XHRcdGlmKHRoaXMuX2NydXJyZW50U2NlbmUuYWN0aXZlQ2FtZXJhICYmIHRoaXMud29ybGQuX211bHRpdXNlckluaXQpe1xuIFx0XHRcdFx0dGhpcy5fY3J1cnJlbnRTY2VuZS5yZW5kZXIoKTtcbiBcdFx0XHR9XG4gXHRcdH0uYmluZCh0aGlzKSk7XG4gXHR9XG4gfVxuIG1vZHVsZS5leHBvcnRzID0gbHNkOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==