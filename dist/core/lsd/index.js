"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),CES=require("ces"),utils=require("./utils/utils"),entities=require("./entities"),Request=require("../xhr/Request"),lsd=function(){function lsd(){_classCallCheck(this,lsd),this._defaults=utils.defaultArgs(),this._data=null,this._crurrentScene,this._e_scene=new entities.e_scene,this._e_cameravr=null,this.world=new CES.World,this.world.addEntity(this._e_scene.entity),this.pickInterval=1,this.canvas,this._assets=[],Promise.all([document.querySelector("canvas")]).then(this.init.apply(this))}return _createClass(lsd,[{key:"init",value:function(){this.canvas=document.querySelector("canvas"),this.defaults=new Request("/assets/scene/scene.json",this.dataLoaded.bind(this))}},{key:"dataLoaded",value:function(){console.log(this.defaults.data),this._data=this.defaults.data,this.canvas.addEventListener("canvas_init",function(t){this.jsonAssets=this._data.assets,this._crurrentScene=this._defaults._scene=this._e_scene.scene.scene,utils.assetsLoad.apply(this)}.bind(this),!1)}},{key:"initListners",value:function(){window.addEventListener("resize",function(){this.canvas.heigth=window.innerHeight,this.canvas.width=window.innerWidth,this._crurrentScene.getEngine().resize()}.bind(this))}},{key:"loopEntites",value:function(t){for(var e=0;e<this._data.entities.length;e++)t(e)}},{key:"setDefaultsAndMaterials",value:function setDefaultsAndMaterials(i){this._data.entities[i].defaults._scene=this._crurrentScene;try{this._data.entities[i].defaults=utils.merge_objects(eval("entities."+this._data.entities[i].defaults.e_type+".defaults()"),this._data.entities[i].defaults)}catch(e){console.log(e+" - error loading entity no defaults set")}}},{key:"setVectorsAndOtherDefaults",value:function setVectorsAndOtherDefaults(i){void 0!=typeof this._data.entities[i].defaults._material&&(this._data.entities[i].defaults._material=utils.getMaterials(this._data.materials,this._data.entities[i].defaults._material)),void 0!=typeof this._data.entities[i].defaults._position&&(this._data.entities[i].defaults._position=utils.getVector(this._data.entities[i].defaults._position)),void 0!=typeof this._data.entities[i].defaults._rotation&&(this._data.entities[i].defaults._rotation=utils.getVector(this._data.entities[i].defaults._rotation,"rotation"));try{var ent=eval("new entities."+this._data.entities[i].defaults.e_type+"(this._data.entities[i].defaults)");this.world.addEntity(ent.entity)}catch(e){console.log(e+" - error loading entity")}}},{key:"assetLoadingFinished",value:function(){this.loopEntites(this.setDefaultsAndMaterials.bind(this)),this.loopEntites(this.setVectorsAndOtherDefaults.bind(this)),this._defaults._name="camera",this._defaults._canvas=this.canvas,this._defaults._position=new BABYLON.Vector3(0,0,0),this._defaults._fpsUI=!0,this._e_cameravr=new entities.e_cameravr(this._defaults),this.world.addEntity(this._e_cameravr.entity),this.initSceneAnimation(),this.initListners()}},{key:"initSceneAnimation",value:function(){this.tick=.01,this._crurrentScene.getEngine().runRenderLoop(function(){this.tick+=.01,window.tick=this.tick,this.tick%this.pickInterval<=.9&&this.tick%this.pickInterval>=.89&&this._e_cameravr.cursor.rayPick(),this._crurrentScene.activeCamera&&(this.world.update(this.tick),this._crurrentScene.render())}.bind(this))}}]),lsd}();module.exports=lsd;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvbHNkL2luZGV4LmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ0VTIiwicmVxdWlyZSIsInV0aWxzIiwiZW50aXRpZXMiLCJSZXF1ZXN0IiwibHNkIiwidGhpcyIsIl9kZWZhdWx0cyIsImRlZmF1bHRBcmdzIiwiX2RhdGEiLCJfY3J1cnJlbnRTY2VuZSIsIl9lX3NjZW5lIiwiZV9zY2VuZSIsIl9lX2NhbWVyYXZyIiwid29ybGQiLCJXb3JsZCIsImFkZEVudGl0eSIsImVudGl0eSIsInBpY2tJbnRlcnZhbCIsImNhbnZhcyIsIl9hc3NldHMiLCJQcm9taXNlIiwiYWxsIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidGhlbiIsImluaXQiLCJhcHBseSIsInZhbHVlIiwiZGVmYXVsdHMiLCJkYXRhTG9hZGVkIiwiYmluZCIsImNvbnNvbGUiLCJsb2ciLCJkYXRhIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJqc29uQXNzZXRzIiwiYXNzZXRzIiwiX3NjZW5lIiwic2NlbmUiLCJhc3NldHNMb2FkIiwid2luZG93IiwiaGVpZ3RoIiwiaW5uZXJIZWlnaHQiLCJ3aWR0aCIsImlubmVyV2lkdGgiLCJnZXRFbmdpbmUiLCJyZXNpemUiLCJfZnVuY3Rpb25DYWxsIiwic2V0RGVmYXVsdHNBbmRNYXRlcmlhbHMiLCJtZXJnZV9vYmplY3RzIiwiZXZhbCIsImVfdHlwZSIsInNldFZlY3RvcnNBbmRPdGhlckRlZmF1bHRzIiwidW5kZWZpbmVkIiwiX21hdGVyaWFsIiwiZ2V0TWF0ZXJpYWxzIiwibWF0ZXJpYWxzIiwiX3Bvc2l0aW9uIiwiZ2V0VmVjdG9yIiwiX3JvdGF0aW9uIiwiZW50IiwibG9vcEVudGl0ZXMiLCJfbmFtZSIsIl9jYW52YXMiLCJCQUJZTE9OIiwiVmVjdG9yMyIsIl9mcHNVSSIsImVfY2FtZXJhdnIiLCJpbml0U2NlbmVBbmltYXRpb24iLCJpbml0TGlzdG5lcnMiLCJ0aWNrIiwicnVuUmVuZGVyTG9vcCIsImN1cnNvciIsInJheVBpY2siLCJhY3RpdmVDYW1lcmEiLCJ1cGRhdGUiLCJyZW5kZXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQUZoSCxHQUFJQyxjQUFlLFdBQWUsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQVMsSUFBSyxHQUFJQyxHQUFJLEVBQUdBLEVBQUlELEVBQU1FLE9BQVFELElBQUssQ0FBRSxHQUFJRSxHQUFhSCxFQUFNQyxFQUFJRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQU9ELEVBQVdFLGNBQWUsRUFBVSxTQUFXRixLQUFZQSxFQUFXRyxVQUFXLEdBQU1DLE9BQU9DLGVBQWVULEVBQVFJLEVBQVdNLElBQUtOLElBQWlCLE1BQU8sVUFBVVIsRUFBYWUsRUFBWUMsR0FBaUosTUFBOUhELElBQVlaLEVBQWlCSCxFQUFZaUIsVUFBV0YsR0FBaUJDLEdBQWFiLEVBQWlCSCxFQUFhZ0IsR0FBcUJoQixNQUY3aEJrQixJQUFNQyxRQUFRLE9BQ2RDLE1BQVFELFFBQVEsaUJBQ2hCRSxTQUFXRixRQUFRLGNBQ25CRyxRQUFVSCxRQUFRLGtCQVNmSSxJQUFHLFdBQ0csUUFETkEsT0FRSHpCLGdCQUFnQjBCLEtBUmJELEtBRUpDLEtBQUtDLFVBQVlMLE1BQU1NLGNBQ3ZCRixLQUFLRyxNQUFRLEtBQ2JILEtBQUtJLGVBQ0xKLEtBQUtLLFNBQVcsR0FBSVIsVUFBU1Ms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eUQsWUFBWXpELEtBQUs0Qyx3QkFBd0JuQixLQUFLekIsT0FDbkRBLEtBQUt5RCxZQUFZekQsS0FBS2dELDJCQUEyQnZCLEtBQUt6QixPQUV0REEsS0FBS0MsVUFBVXlELE1BQVEsU0FDdkIxRCxLQUFLQyxVQUFVMEQsUUFBVTNELEtBQUthLE9BQzlCYixLQUFLQyxVQUFVb0QsVUFBWSxHQUFJTyxTQUFRQyxRQUFRLEVBQUcsRUFBRyxHQUNyRDdELEtBQUtDLFVBQVU2RCxRQUFTLEVBQ3hCOUQsS0FBS08sWUFBYyxHQUFJVixVQUFTa0UsV0FBVy9ELEtBQUtDLFdBQ2hERCxLQUFLUSxNQUFNRSxVQUFVVixLQUFLTyxZQUFZSSxRQUN0Q1gsS0FBS2dFLHFCQUNMaEUsS0FBS2lFLGtCQWtCSjNFLElBQUsscUJBQ0xnQyxNQWhCZ0IsV0FDakJ0QixLQUFLa0UsS0FBTyxJQUNabEUsS0FBS0ksZUFBZXFDLFlBQVkwQixjQUFjLFdBQzdDbkUsS0FBS2tFLE1BQVEsSUFDYjlCLE9BQU84QixLQUFPbEUsS0FBS2tFLEtBQ2hCbEUsS0FBS2tFLEtBQU9sRSxLQUFLWSxjQUFpQixJQUFPWixLQUFLa0UsS0FBT2xFLEtBQUtZLGNBQWlCLEtBQzdFWixLQUFLTyxZQUFZNkQsT0FBT0MsVUFFdEJyRSxLQUFLSSxlQUFla0UsZUFDdEJ0RSxLQUFLUSxNQUFNK0QsT0FBT3ZFLEtBQUtrRSxNQUN2QmxFLEtBQUtJLGVBQWVvRSxXQUVwQi9DLEtBQUt6QixXQW5HSEQsTUFzR04wRSxRQUFPQyxRQUFVM0UiLCJmaWxlIjoiY29yZS9sc2QvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgQ0VTID0gcmVxdWlyZSgnY2VzJyk7XG52YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzJyk7XG52YXIgZW50aXRpZXMgPSByZXF1aXJlKCcuL2VudGl0aWVzJyk7XG52YXIgUmVxdWVzdCA9IHJlcXVpcmUoJy4uL3hoci9SZXF1ZXN0Jyk7XG5cblxuLyoqXG4gKiAuLi5cbiAqIEBhdXRob3IgQnJlbmRvbiBTbWl0aFxuICogaHR0cDovL3NlYWNsb3VkOS5vcmdcbiAqIExpZ2h0V2VpZ2h0IDNEIFN5c3RlbSBEZXNpZ24gZW5naW5lXG4gKi9cbiBjbGFzcyBsc2R7XG4gXHRjb25zdHJ1Y3Rvcigpe1xuIFx0XHR0aGlzLl9kZWZhdWx0cyA9IHV0aWxzLmRlZmF1bHRBcmdzKCk7XG4gXHRcdHRoaXMuX2RhdGEgPSBudWxsO1xuIFx0XHR0aGlzLl9jcnVycmVudFNjZW5lO1xuIFx0XHR0aGlzLl9lX3NjZW5lID0gbmV3IGVudGl0aWVzLmVfc2NlbmUoKTtcbiBcdFx0dGhpcy5fZV9jYW1lcmF2ciA9IG51bGw7XG4gXHRcdHRoaXMud29ybGQgPSBuZXcgQ0VTLldvcmxkKCk7XG4gXHRcdHRoaXMud29ybGQuYWRkRW50aXR5KHRoaXMuX2Vfc2NlbmUuZW50aXR5KTtcbiBcdFx0dGhpcy5waWNrSW50ZXJ2YWwgPSAxO1xuIFx0XHR0aGlzLmNhbnZhcztcbiBcdFx0dGhpcy5fYXNzZXRzID0gW107XG4gXHRcdFByb21pc2UuYWxsKFtkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKV0pLnRoZW4odGhpcy5pbml0LmFwcGx5KHRoaXMpKTtcbiBcdH1cblxuIFx0aW5pdCgpe1xuIFx0XHR0aGlzLmNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpO1xuIFx0XHR0aGlzLmRlZmF1bHRzID0gbmV3IFJlcXVlc3QoXCIvYXNzZXRzL3NjZW5lL3NjZW5lLmpzb25cIiwgdGhpcy5kYXRhTG9hZGVkLmJpbmQodGhpcykpO1xuIFx0fVxuXG4gXHRkYXRhTG9hZGVkKCl7XG4gXHRcdGNvbnNvbGUubG9nKHRoaXMuZGVmYXVsdHMuZGF0YSk7XG4gXHRcdHRoaXMuX2RhdGEgID0gdGhpcy5kZWZhdWx0cy5kYXRhO1xuIFx0XHR0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjYW52YXNfaW5pdCcsIGZ1bmN0aW9uIChlKSB7XG4gXHRcdFx0dGhpcy5qc29uQXNzZXRzID0gdGhpcy5fZGF0YS5hc3NldHM7XG4gXHRcdFx0dGhpcy5fY3J1cnJlbnRTY2VuZSA9IHRoaXMuX2RlZmF1bHRzLl9zY2VuZSA9IHRoaXMuX2Vfc2NlbmUuc2NlbmUuc2NlbmU7XG4gXHRcdFx0dXRpbHMuYXNzZXRzTG9hZC5hcHBseSh0aGlzKTtcbiBcdFx0fS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiBcdH1cblxuIFx0aW5pdExpc3RuZXJzKCl7XG4gXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiBcdFx0XHR0aGlzLmNhbnZhcy5oZWlndGggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gXHRcdFx0dGhpcy5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcdFxuIFx0XHRcdHRoaXMuX2NydXJyZW50U2NlbmUuZ2V0RW5naW5lKCkucmVzaXplKCk7XG4gXHRcdH0uYmluZCh0aGlzKSk7XG4gXHR9XG5cbiBcdGxvb3BFbnRpdGVzKF9mdW5jdGlvbkNhbGwpe1xuIFx0XHRmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5fZGF0YS5lbnRpdGllcy5sZW5ndGg7IGkrKyl7XG4gXHRcdFx0X2Z1bmN0aW9uQ2FsbChpKTtcbiBcdFx0fVxuIFx0fVxuXG4gXHRzZXREZWZhdWx0c0FuZE1hdGVyaWFscyhpKXtcbiBcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fc2NlbmUgPSB0aGlzLl9jcnVycmVudFNjZW5lO1xuIFx0XHR0cnl7XG4gXHRcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cyA9IHV0aWxzLm1lcmdlX29iamVjdHMoZXZhbCgnZW50aXRpZXMuJyArIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuZV90eXBlK1wiLmRlZmF1bHRzKClcIiksIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMpO1xuIFx0XHR9Y2F0Y2goZSl7XG4gXHRcdFx0Y29uc29sZS5sb2coZSArICcgLSBlcnJvciBsb2FkaW5nIGVudGl0eSBubyBkZWZhdWx0cyBzZXQnKTtcbiBcdFx0fVxuIFx0fVxuXG4gXHRzZXRWZWN0b3JzQW5kT3RoZXJEZWZhdWx0cyhpKXtcbiBcdFx0aWYodHlwZW9mIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX21hdGVyaWFsICE9IHVuZGVmaW5lZCl7XG4gXHRcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fbWF0ZXJpYWwgPSB1dGlscy5nZXRNYXRlcmlhbHModGhpcy5fZGF0YS5tYXRlcmlhbHMsIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX21hdGVyaWFsKTtcbiBcdFx0fVxuIFx0XHRpZih0eXBlb2YgdGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcG9zaXRpb24gIT0gdW5kZWZpbmVkKXtcbiBcdFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9wb3NpdGlvbiA9IHV0aWxzLmdldFZlY3Rvcih0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9wb3NpdGlvbik7XG4gXHRcdH1cbiBcdFx0aWYodHlwZW9mIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3JvdGF0aW9uICE9IHVuZGVmaW5lZCl7XG4gXHRcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcm90YXRpb24gPSB1dGlscy5nZXRWZWN0b3IodGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcm90YXRpb24sICdyb3RhdGlvbicpO1xuIFx0XHR9XG4gXHRcdHRyeXtcbiBcdFx0XHR2YXIgZW50ID0gZXZhbChcIm5ldyBlbnRpdGllcy5cIiArIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuZV90eXBlICsgXCIodGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cylcIik7XG4gXHRcdFx0dGhpcy53b3JsZC5hZGRFbnRpdHkoZW50LmVudGl0eSk7XG4gXHRcdH1jYXRjaChlKXtcbiBcdFx0XHRjb25zb2xlLmxvZyhlICsgJyAtIGVycm9yIGxvYWRpbmcgZW50aXR5Jyk7XG4gXHRcdH1cbiBcdH1cblxuIFx0YXNzZXRMb2FkaW5nRmluaXNoZWQoKXtcbiBcdFx0XG4gXHRcdHRoaXMubG9vcEVudGl0ZXModGhpcy5zZXREZWZhdWx0c0FuZE1hdGVyaWFscy5iaW5kKHRoaXMpKTtcbiBcdFx0dGhpcy5sb29wRW50aXRlcyh0aGlzLnNldFZlY3RvcnNBbmRPdGhlckRlZmF1bHRzLmJpbmQodGhpcykpO1xuXG4gXHRcdHRoaXMuX2RlZmF1bHRzLl9uYW1lID0gJ2NhbWVyYSc7XG4gXHRcdHRoaXMuX2RlZmF1bHRzLl9jYW52YXMgPSB0aGlzLmNhbnZhcztcbiBcdFx0dGhpcy5fZGVmYXVsdHMuX3Bvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygwLCAwLCAwKTtcbiBcdFx0dGhpcy5fZGVmYXVsdHMuX2Zwc1VJID0gdHJ1ZTtcbiBcdFx0dGhpcy5fZV9jYW1lcmF2ciA9IG5ldyBlbnRpdGllcy5lX2NhbWVyYXZyKHRoaXMuX2RlZmF1bHRzKTtcbiBcdFx0dGhpcy53b3JsZC5hZGRFbnRpdHkodGhpcy5fZV9jYW1lcmF2ci5lbnRpdHkpO1xuIFx0XHR0aGlzLmluaXRTY2VuZUFuaW1hdGlvbigpO1xuIFx0XHR0aGlzLmluaXRMaXN0bmVycygpO1xuIFx0fVxuXG4gXHRpbml0U2NlbmVBbmltYXRpb24oKXtcbiBcdFx0dGhpcy50aWNrID0gMC4wMTtcbiBcdFx0dGhpcy5fY3J1cnJlbnRTY2VuZS5nZXRFbmdpbmUoKS5ydW5SZW5kZXJMb29wKGZ1bmN0aW9uICgpIHtcbiBcdFx0XHR0aGlzLnRpY2sgKz0gLjAxO1xuIFx0XHRcdHdpbmRvdy50aWNrID0gdGhpcy50aWNrO1xuIFx0XHRcdGlmKHRoaXMudGljayAlIHRoaXMucGlja0ludGVydmFsICA8PSAwLjkgJiYgdGhpcy50aWNrICUgdGhpcy5waWNrSW50ZXJ2YWwgID49IDAuODkpe1xuIFx0XHRcdFx0dGhpcy5fZV9jYW1lcmF2ci5jdXJzb3IucmF5UGljaygpO1xuIFx0XHRcdH1cbiBcdFx0XHRpZih0aGlzLl9jcnVycmVudFNjZW5lLmFjdGl2ZUNhbWVyYSl7XG4gXHRcdFx0XHR0aGlzLndvcmxkLnVwZGF0ZSh0aGlzLnRpY2spO1xuIFx0XHRcdFx0dGhpcy5fY3J1cnJlbnRTY2VuZS5yZW5kZXIoKTtcbiBcdFx0XHR9XG4gXHRcdH0uYmluZCh0aGlzKSk7XG4gXHR9XG4gfVxuIG1vZHVsZS5leHBvcnRzID0gbHNkOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==