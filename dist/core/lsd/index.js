"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),CES=require("ces"),utils=require("./utils/utils"),entities=require("./entities"),systems=require("./systems"),Request=require("../xhr/Request"),lsd=function(){function lsd(){_classCallCheck(this,lsd),this._defaults=utils.defaultArgs(),this._data=null,this._crurrentScene,this._e_scene=new entities.e_scene,this._e_cameravr=null,this.camera=null,this.world=new CES.World,this.world.addEntity(this._e_scene.entity),this.canvas,this._assets=[],Promise.all([document.querySelector("canvas")]).then(this.init.apply(this))}return _createClass(lsd,[{key:"init",value:function(){this.canvas=document.querySelector("canvas"),this.defaults=new Request("/assets/scene/scene.json",this.dataLoaded.bind(this))}},{key:"dataLoaded",value:function(){console.log(this.defaults.data),this._data=this.defaults.data,this.canvas.addEventListener("canvas_init",function(t){this.jsonAssets=this._data.assets,this._crurrentScene=this._defaults._scene=this._e_scene.scene.scene,utils.assetsLoad.apply(this)}.bind(this),!1)}},{key:"initListners",value:function(){window.addEventListener("resize",function(){this.canvas.heigth=window.innerHeight,this.canvas.width=window.innerWidth,this._crurrentScene.getEngine().resize()}.bind(this))}},{key:"loopJsonArr",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"entities":arguments[1];switch(e){case"entities":for(var s=0;s<this._data.entities.length;s++)t(s);break;case"systems":for(var s=0;s<this._data.systems.length;s++)t(s);break;default:for(var s=0;s<this._data.entities.length;s++)t(s)}}},{key:"setDefaultsAndMaterials",value:function setDefaultsAndMaterials(i){this._data.entities[i].defaults._scene=this._crurrentScene,this._data.entities[i].defaults._canvas=this.canvas;try{this._data.entities[i].defaults=utils.merge_objects(eval("entities."+this._data.entities[i].defaults.e_type+".defaults()"),this._data.entities[i].defaults)}catch(e){console.log(e+" - error loading entity no defaults set")}}},{key:"setVectorsAndOtherDefaults",value:function setVectorsAndOtherDefaults(i){void 0!=typeof this._data.entities[i].defaults._material&&(this._data.entities[i].defaults._material=utils.getMaterials(this._data.materials,this._data.entities[i].defaults._material)),void 0!=typeof this._data.entities[i].defaults._position&&(this._data.entities[i].defaults._position=utils.getVector(this._data.entities[i].defaults._position)),void 0!=typeof this._data.entities[i].defaults._rotation&&(this._data.entities[i].defaults._rotation=utils.getVector(this._data.entities[i].defaults._rotation,"rotation"));try{var ent=eval("new entities."+this._data.entities[i].defaults.e_type+"(this._data.entities[i].defaults)");this.world.addEntity(ent.entity)}catch(e){console.log(e+" - error loading entity")}}},{key:"setSystems",value:function setSystems(i){try{this._data.systems[i].defaults._canvas=this.canvas,this._data.systems[i].defaults._scene=this._crurrentScene,this.world.addSystem(eval("new systems."+this._data.systems[i].defaults.s_type+"(this._data.systems[i].defaults)"))}catch(e){console.log(e+" - error loading system")}}},{key:"assetLoadingFinished",value:function(){this.loopJsonArr(this.setDefaultsAndMaterials.bind(this)),this.loopJsonArr(this.setVectorsAndOtherDefaults.bind(this)),this.loopJsonArr(this.setSystems.bind(this),"systems"),this.initSceneAnimation(),this.initListners()}},{key:"initSceneAnimation",value:function(){this.tick=.01,window.scene=this._crurrentScene,this.world._crurrentScene=this._crurrentScene,this._crurrentScene.getEngine().runRenderLoop(function(){this.tick+=.01,window.tick=this.tick,this._crurrentScene.activeCamera&&(this.world.update(this.tick),this._crurrentScene.render())}.bind(this))}}]),lsd}();module.exports=lsd;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvbHNkL2luZGV4LmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ0VTIiwicmVxdWlyZSIsInV0aWxzIiwiZW50aXRpZXMiLCJzeXN0ZW1zIiwiUmVxdWVzdCIsImxzZCIsInRoaXMiLCJfZGVmYXVsdHMiLCJkZWZhdWx0QXJncyIsIl9kYXRhIiwiX2NydXJyZW50U2NlbmUiLCJfZV9zY2VuZSIsImVfc2NlbmUiLCJfZV9jYW1lcmF2ciIsImNhbWVyYSIsIndvcmxkIiwiV29ybGQiLCJhZGRFbnRpdHkiLCJlbnRpdHkiLCJjYW52YXMiLCJfYXNzZXRzIiwiUHJvbWlzZSIsImFsbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRoZW4iLCJpbml0IiwiYXBwbHkiLCJ2YWx1ZSIsImRlZmF1bHRzIiwiZGF0YUxvYWRlZCIsImJpbmQiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwianNvbkFzc2V0cyIsImFzc2V0cyIsIl9zY2VuZSIsInNjZW5lIiwiYXNzZXRzTG9hZCIsIndpbmRvdyIsImhlaWd0aCIsImlubmVySGVpZ2h0Iiwid2lkdGgiLCJpbm5lcldpZHRoIiwiZ2V0RW5naW5lIiwicmVzaXplIiwiX2Z1bmN0aW9uQ2FsbCIsIl90eXBlIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwic2V0RGVmYXVsdHNBbmRNYXRlcmlhbHMiLCJfY2FudmFzIiwibWVyZ2Vfb2JqZWN0cyIsImV2YWwiLCJlX3R5cGUiLCJzZXRWZWN0b3JzQW5kT3RoZXJEZWZhdWx0cyIsIl9tYXRlcmlhbCIsImdldE1hdGVyaWFscyIsIm1hdGVyaWFscyIsIl9wb3NpdGlvbiIsImdldFZlY3RvciIsIl9yb3RhdGlvbiIsImVudCIsInNldFN5c3RlbXMiLCJhZGRTeXN0ZW0iLCJzX3R5cGUiLCJsb29wSnNvbkFyciIsImluaXRTY2VuZUFuaW1hdGlvbiIsImluaXRMaXN0bmVycyIsInRpY2siLCJydW5SZW5kZXJMb29wIiwiYWN0aXZlQ2FtZXJhIiwidXBkYXRlIiwicmVuZGVyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFJQSxTQUFTQSxpQkFBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsWUFBb0JDLElBQWdCLEtBQU0sSUFBSUMsV0FBVSxxQ0FGaEgsR0FBSUMsY0FBZSxXQUFlLFFBQVNDLEdBQWlCQyxFQUFRQyxHQUFTLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRCxFQUFNRSxPQUFRRCxJQUFLLENBQUUsR0FBSUUsR0FBYUgsRUFBTUMsRUFBSUUsR0FBV0MsV0FBYUQsRUFBV0MsYUFBYyxFQUFPRCxFQUFXRSxjQUFlLEVBQVUsU0FBV0YsS0FBWUEsRUFBV0csVUFBVyxHQUFNQyxPQUFPQyxlQUFlVCxFQUFRSSxFQUFXTSxJQUFLTixJQUFpQixNQUFPLFVBQVVSLEVBQWFlLEVBQVlDLEdBQWlKLE1BQTlIRCxJQUFZWixFQUFpQkgsRUFBWWlCLFVBQVdGLEdBQWlCQyxHQUFhYixFQUFpQkgsRUFBYWdCLEdBQXFCaEIsTUFGN2hCa0IsSUFBTUMsUUFBUSxPQUNkQyxNQUFRRCxRQUFRLGlCQUNoQkUsU0FBV0YsUUFBUSxjQUNuQkcsUUFBVUgsUUFBUSxhQUNsQkksUUFBVUosUUFBUSxrQkFTZkssSUFBRyxXQUNHLFFBRE5BLE9BUUgxQixnQkFBZ0IyQixLQVJiRCxLQUVKQyxLQUFLQyxVQUFZTixNQUFNTyxjQUN2QkYsS0FBS0csTUFBUSxLQUNiSCxLQUFLSSxlQUNMSixLQUFLSyxTQUFXLEdBQUlU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YjlCLE9BQU84QixLQUFPbEUsS0FBS2tFLEtBQ2hCbEUsS0FBS0ksZUFBZWdFLGVBQ3RCcEUsS0FBS1MsTUFBTTRELE9BQU9yRSxLQUFLa0UsTUFDdkJsRSxLQUFLSSxlQUFla0UsV0FFcEI3QyxLQUFLekIsV0F2SEhELE1BMEhOd0UsUUFBT0MsUUFBVXpFIiwiZmlsZSI6ImNvcmUvbHNkL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIENFUyA9IHJlcXVpcmUoJ2NlcycpO1xudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscy91dGlscycpO1xudmFyIGVudGl0aWVzID0gcmVxdWlyZSgnLi9lbnRpdGllcycpO1xudmFyIHN5c3RlbXMgPSByZXF1aXJlKCcuL3N5c3RlbXMnKTtcbnZhciBSZXF1ZXN0ID0gcmVxdWlyZSgnLi4veGhyL1JlcXVlc3QnKTtcblxuXG4vKipcbiAqIC4uLlxuICogQGF1dGhvciBCcmVuZG9uIFNtaXRoXG4gKiBodHRwOi8vc2VhY2xvdWQ5Lm9yZ1xuICogTGlnaHRXZWlnaHQgM0QgU3lzdGVtIERlc2lnbiBlbmdpbmVcbiAqL1xuIGNsYXNzIGxzZHtcbiBcdGNvbnN0cnVjdG9yKCl7XG4gXHRcdHRoaXMuX2RlZmF1bHRzID0gdXRpbHMuZGVmYXVsdEFyZ3MoKTtcbiBcdFx0dGhpcy5fZGF0YSA9IG51bGw7XG4gXHRcdHRoaXMuX2NydXJyZW50U2NlbmU7XG4gXHRcdHRoaXMuX2Vfc2NlbmUgPSBuZXcgZW50aXRpZXMuZV9zY2VuZSgpO1xuIFx0XHR0aGlzLl9lX2NhbWVyYXZyID0gbnVsbDtcbiBcdFx0dGhpcy5jYW1lcmEgPSBudWxsO1xuIFx0XHR0aGlzLndvcmxkID0gbmV3IENFUy5Xb3JsZCgpO1xuIFx0XHR0aGlzLndvcmxkLmFkZEVudGl0eSh0aGlzLl9lX3NjZW5lLmVudGl0eSk7XG4gXHRcdHRoaXMuY2FudmFzO1xuIFx0XHR0aGlzLl9hc3NldHMgPSBbXTtcbiBcdFx0UHJvbWlzZS5hbGwoW2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpXSkudGhlbih0aGlzLmluaXQuYXBwbHkodGhpcykpO1xuIFx0fVxuXG4gXHRpbml0KCl7XG4gXHRcdHRoaXMuY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY2FudmFzJyk7XG4gXHRcdHRoaXMuZGVmYXVsdHMgPSBuZXcgUmVxdWVzdChcIi9hc3NldHMvc2NlbmUvc2NlbmUuanNvblwiLCB0aGlzLmRhdGFMb2FkZWQuYmluZCh0aGlzKSk7XG4gXHR9XG5cbiBcdGRhdGFMb2FkZWQoKXtcbiBcdFx0Y29uc29sZS5sb2codGhpcy5kZWZhdWx0cy5kYXRhKTtcbiBcdFx0dGhpcy5fZGF0YSAgPSB0aGlzLmRlZmF1bHRzLmRhdGE7XG4gXHRcdHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NhbnZhc19pbml0JywgZnVuY3Rpb24gKGUpIHtcbiBcdFx0XHR0aGlzLmpzb25Bc3NldHMgPSB0aGlzLl9kYXRhLmFzc2V0cztcbiBcdFx0XHR0aGlzLl9jcnVycmVudFNjZW5lID0gdGhpcy5fZGVmYXVsdHMuX3NjZW5lID0gdGhpcy5fZV9zY2VuZS5zY2VuZS5zY2VuZTtcbiBcdFx0XHR1dGlscy5hc3NldHNMb2FkLmFwcGx5KHRoaXMpO1xuIFx0XHR9LmJpbmQodGhpcyksIGZhbHNlKTtcblxuIFx0fVxuXG4gXHRpbml0TGlzdG5lcnMoKXtcbiBcdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgZnVuY3Rpb24gKCkge1xuIFx0XHRcdHRoaXMuY2FudmFzLmhlaWd0aCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiBcdFx0XHR0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1x0XG4gXHRcdFx0dGhpcy5fY3J1cnJlbnRTY2VuZS5nZXRFbmdpbmUoKS5yZXNpemUoKTtcbiBcdFx0fS5iaW5kKHRoaXMpKTtcbiBcdH1cblxuIFx0bG9vcEpzb25BcnIoX2Z1bmN0aW9uQ2FsbCwgX3R5cGUgPSAnZW50aXRpZXMnKXtcbiBcdFx0c3dpdGNoKF90eXBlKSB7XG5cdFx0ICAgIGNhc2UgJ2VudGl0aWVzJzpcblx0XHQgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLl9kYXRhLmVudGl0aWVzLmxlbmd0aDsgaSsrKXtcblx0XHQgXHRcdFx0X2Z1bmN0aW9uQ2FsbChpKTtcblx0XHQgXHRcdH1cblx0XHQgICAgICAgIGJyZWFrO1xuXHRcdCAgICBjYXNlICdzeXN0ZW1zJzpcblx0XHQgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5fZGF0YS5zeXN0ZW1zLmxlbmd0aDsgaSsrKXtcblx0XHQgXHRcdFx0X2Z1bmN0aW9uQ2FsbChpKTtcblx0XHQgXHRcdH1cblx0XHQgICAgICAgIGJyZWFrO1x0ICAgICAgICBcdFx0ICAgICAgICBcblx0XHQgICAgZGVmYXVsdDpcblx0XHQgICAgIFx0Zm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX2RhdGEuZW50aXRpZXMubGVuZ3RoOyBpKyspe1xuXHRcdCBcdFx0XHRfZnVuY3Rpb25DYWxsKGkpO1xuXHRcdCBcdFx0fVxuXHRcdFxuXHRcdH1cbiBcdFx0XG4gXHR9XG5cbiBcdHNldERlZmF1bHRzQW5kTWF0ZXJpYWxzKGkpe1xuIFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9zY2VuZSA9IHRoaXMuX2NydXJyZW50U2NlbmU7XG4gXHRcdHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX2NhbnZhcyA9IHRoaXMuY2FudmFzO1xuIFx0XHR0cnl7XG4gXHRcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cyA9IHV0aWxzLm1lcmdlX29iamVjdHMoZXZhbCgnZW50aXRpZXMuJyArIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuZV90eXBlK1wiLmRlZmF1bHRzKClcIiksIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMpO1xuIFx0XHR9Y2F0Y2goZSl7XG4gXHRcdFx0Y29uc29sZS5sb2coZSArICcgLSBlcnJvciBsb2FkaW5nIGVudGl0eSBubyBkZWZhdWx0cyBzZXQnKTtcbiBcdFx0fVxuIFx0fVxuXG4gXHRzZXRWZWN0b3JzQW5kT3RoZXJEZWZhdWx0cyhpKXtcbiBcdFx0aWYodHlwZW9mIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX21hdGVyaWFsICE9IHVuZGVmaW5lZCl7XG4gXHRcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fbWF0ZXJpYWwgPSB1dGlscy5nZXRNYXRlcmlhbHModGhpcy5fZGF0YS5tYXRlcmlhbHMsIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX21hdGVyaWFsKTtcbiBcdFx0fVxuIFx0XHRpZih0eXBlb2YgdGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcG9zaXRpb24gIT0gdW5kZWZpbmVkKXtcbiBcdFx0XHR0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9wb3NpdGlvbiA9IHV0aWxzLmdldFZlY3Rvcih0aGlzLl9kYXRhLmVudGl0aWVzW2ldLmRlZmF1bHRzLl9wb3NpdGlvbik7XG4gXHRcdH1cbiBcdFx0aWYodHlwZW9mIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuX3JvdGF0aW9uICE9IHVuZGVmaW5lZCl7XG4gXHRcdFx0dGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcm90YXRpb24gPSB1dGlscy5nZXRWZWN0b3IodGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cy5fcm90YXRpb24sICdyb3RhdGlvbicpO1xuIFx0XHR9XG4gXHRcdHRyeXtcbiBcdFx0XHR2YXIgZW50ID0gZXZhbChcIm5ldyBlbnRpdGllcy5cIiArIHRoaXMuX2RhdGEuZW50aXRpZXNbaV0uZGVmYXVsdHMuZV90eXBlICsgXCIodGhpcy5fZGF0YS5lbnRpdGllc1tpXS5kZWZhdWx0cylcIik7XG4gXHRcdFx0dGhpcy53b3JsZC5hZGRFbnRpdHkoZW50LmVudGl0eSk7XG4gXHRcdH1jYXRjaChlKXtcbiBcdFx0XHRjb25zb2xlLmxvZyhlICsgJyAtIGVycm9yIGxvYWRpbmcgZW50aXR5Jyk7XG4gXHRcdH1cbiBcdH1cblxuIFx0c2V0U3lzdGVtcyhpKXtcbiBcdFx0dHJ5e1xuIFx0XHRcdHRoaXMuX2RhdGEuc3lzdGVtc1tpXS5kZWZhdWx0cy5fY2FudmFzID0gdGhpcy5jYW52YXM7XG4gXHRcdFx0dGhpcy5fZGF0YS5zeXN0ZW1zW2ldLmRlZmF1bHRzLl9zY2VuZSA9IHRoaXMuX2NydXJyZW50U2NlbmU7XG4gXHRcdFx0dGhpcy53b3JsZC5hZGRTeXN0ZW0oIGV2YWwoXCJuZXcgc3lzdGVtcy5cIiArIHRoaXMuX2RhdGEuc3lzdGVtc1tpXS5kZWZhdWx0cy5zX3R5cGUgKyBcIih0aGlzLl9kYXRhLnN5c3RlbXNbaV0uZGVmYXVsdHMpXCIpKTtcbiBcdFx0fWNhdGNoKGUpe1xuIFx0XHRcdGNvbnNvbGUubG9nKGUgKyAnIC0gZXJyb3IgbG9hZGluZyBzeXN0ZW0nKTtcbiBcdFx0fVxuIFx0fVxuXG5cbiBcdGFzc2V0TG9hZGluZ0ZpbmlzaGVkKCl7XG4gXHRcdHRoaXMubG9vcEpzb25BcnIodGhpcy5zZXREZWZhdWx0c0FuZE1hdGVyaWFscy5iaW5kKHRoaXMpKTtcbiBcdFx0dGhpcy5sb29wSnNvbkFycih0aGlzLnNldFZlY3RvcnNBbmRPdGhlckRlZmF1bHRzLmJpbmQodGhpcykpO1xuIFx0XHR0aGlzLmxvb3BKc29uQXJyKHRoaXMuc2V0U3lzdGVtcy5iaW5kKHRoaXMpLCAnc3lzdGVtcycpO1xuIFx0XHR0aGlzLmluaXRTY2VuZUFuaW1hdGlvbigpO1xuIFx0XHR0aGlzLmluaXRMaXN0bmVycygpO1xuIFx0fVxuXG4gXHRpbml0U2NlbmVBbmltYXRpb24oKXtcbiBcdFx0dGhpcy50aWNrID0gMC4wMTtcbiBcdFx0Ly8gdG9kbyByZW1vdmUgdGhpcyBvbmx5IGZvciBkZWJ1Z2dpbmcgcHVycG9zZXNcbiBcdFx0d2luZG93LnNjZW5lID0gdGhpcy5fY3J1cnJlbnRTY2VuZTtcbiBcdFx0dGhpcy53b3JsZC5fY3J1cnJlbnRTY2VuZSA9IHRoaXMuX2NydXJyZW50U2NlbmU7XG4gXHRcdHRoaXMuX2NydXJyZW50U2NlbmUuZ2V0RW5naW5lKCkucnVuUmVuZGVyTG9vcChmdW5jdGlvbiAoKSB7XG4gXHRcdFx0dGhpcy50aWNrICs9IC4wMTtcbiBcdFx0XHR3aW5kb3cudGljayA9IHRoaXMudGljaztcbiBcdFx0XHRpZih0aGlzLl9jcnVycmVudFNjZW5lLmFjdGl2ZUNhbWVyYSl7XG4gXHRcdFx0XHR0aGlzLndvcmxkLnVwZGF0ZSh0aGlzLnRpY2spO1xuIFx0XHRcdFx0dGhpcy5fY3J1cnJlbnRTY2VuZS5yZW5kZXIoKTtcbiBcdFx0XHR9XG4gXHRcdH0uYmluZCh0aGlzKSk7XG4gXHR9XG4gfVxuIG1vZHVsZS5leHBvcnRzID0gbHNkOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==